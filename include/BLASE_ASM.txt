        MACRO-80 3.43   27-Jul-81       PAGE    1


                                ;----------
                                ;  TESTPROGRMM
                                ;   01.12.2007
                                ;   27.12.2017 BIOS ANGEPASST NEU AUFGESETZT
                                ;----------
                                ;  ab USER=0 -> zu Eingabetext nach Blase suchen 
                                ;  Aus Bildschirm Blase TYPE1=0, TYPE2=0 als Maskedarstellung
                                ;  TYPE1, TYPE2 > 0 fuer Daten
                                ;-----------------------------------------------
  0000'                         ASEG
                                
                                .Z80
                                
                                
                                ORG 100H
                                
  0001                          DISPLAY EQU 1           ; 1=MIT DISPAY
                                
                         C      INCLUDE BLASEINI.MAC
                         C      ; BLASEINI.MAC
                         C      ; VERS. 1.0     05.04.2018
                         C      ;----------
                         C      ;  initialization vectoren
                         C      ;----------
                         C      
  6000                   C      RAM     EQU 6000H       ; A HIER FREIE RAMBEREICH
                         C      
  6200                   C      BLAN    EQU RAM+200H    ; L[NGR DER DARSTELLUNG
  7000                   C      PROG    EQU RAM+1000H   ; Programm auf Adresse uebertragen
                         C      ;------------------------
                         C      ; IN BLASE ENTHALTEN
                         C      
  6201                   C      USER    EQU BLAN+1      ; Benutzer Blasenspeicher festlegen 
  6202                   C      TYPE1   EQU USER+1      ; Anwendung
  6203                   C      TYPE2   EQU TYPE1+1     ; Anwendung
  6204                   C      TERM    EQU TYPE2+1     ; Gedaechtniszaehler    
  6205                   C      BSTAT   EQU TERM+1      ; Blasenstatus BYTE
                         C              ; Bit: 7 Gedaechtnisszaehler +/-
                         C              ; Bit: 6 Sortieren Stop/Start
                         C              ; Bit: 5
                         C              ;-------------------
  6500                   C      BFRLL   EQU RAM+500H    ; Aktuelle Blasen Adresse speichern
  6501                   C      BFRLH   EQU BFRLL+1
  6502                   C      BFRHL   EQU BFRLH+1
  6503                   C      BFRHH   EQU BFRHL+1
  6508                   C      BFVLL   EQU BFRHH+5     ; Aktuelle Blasen Adresse zum Vergleichen
  6509                   C      BFVLH   EQU BFVLL+1
  650A                   C      BFVHL   EQU BFVLH+1
  650B                   C      BFVHH   EQU BFVHL+1
  650C                   C      BFSLL   EQU BFVHH+1     ; Aktuelle Blasen Adresse zum Sortieren
  650D                   C      BFSLH   EQU BFSLL+1
  650E                   C      BFSHL   EQU BFSLH+1
  650F                   C      BFSHH   EQU BFSHL+1
  6510                   C      LOGLL   EQU BFSHH+1
  6511                   C      LOGLH   EQU LOGLL+1
  6512                   C      LOGHL   EQU LOGLH+1
        MACRO-80 3.43   27-Jul-81       PAGE    1-1


  6513                   C      LOGHH   EQU LOGHL+1
  6518                   C      CURS    EQU LOGHH+5     ; Aktuelle Cursor position
  651C                   C      CURT    EQU CURS+4      ; Cursor in Task (UHR)
  6520                   C      SANDB   EQU CURT+4
  6524                   C      RADR    EQU SANDB+4     ; Aktuelle ausgabe Adresstabelle 16Bit
  6526                   C      RMEN    EQU RADR+2      ; 8Bit
  6527                   C      RAMV    EQU RMEN+1      
  6727                   C      RAMS    EQU RAMV+200H   
  6B27                   C      RAMT    EQU RAMS+400H
  6BEF                   C      RTEX    EQU RAMT+200D
  6C3F                   C      COP     EQU RTEX+80D
                         C      
  0800                   C      HDD     EQU 0800H       ; Startadresse HDD
  00BE                   C      HDDE    EQU 00BEH       ; = 19,9...GB 16363CYL, 16HDS, 63SEC, LBA 39102336
  A101                   C      MMC     EQU 0A101H      ; Startadresse nach LW A:
  0007                   C      MMCE    EQU 07H         ; Ende 256MB Karte
                         C      ;-----------------------
                         C      ;   OFFSET BLASENEINTEILUNGS
                         C      
  0000                   C      RBLAN   EQU 00H         ; Length of the presentation
  0001                   C      RUSER   EQU RBLAN+1     ; Transfer program to address 
  0002                   C      RTYPE1  EQU RUSER+1     ; application User
  0003                   C      RTYPE2  EQU RTYPE1+1    ; application type
  0004                   C      RTERM   EQU RTYPE2+1    ; memory counter
  0005                   C      RBSTAT  EQU RTERM+1     ; Bubble Status Byte
  0006                   C      RSOTR   EQU RBSTAT+1    ; Buffer while searching        
                         C      ;------------------------
                         C      
  0004                   C      SELDM   EQU 04H         ; 0A4H MASTER LAUFWERK E: ZUM PROGRAMME LADEN 
  00F7                   C      SELDS   EQU 0F7H        ; 0F7H SLAVE LAUFWERK H:
  005C                   C      FCB     EQU 005CH       ; FCB address
  0080                   C      BUFF    EQU 0080H       ; input buffer
                         C      ;
  005D                   C      FCBFN   EQU FCB+1       ; file name
  0065                   C      FCBFT   EQU FCB+9       ; file type
  006B                   C      FCBCR   EQU FCB+15      ; record-number
  007C                   C      FCBRA   EQU 7CH         ; insertion counter
                         C      
  00F0                   C      IDE     EQU 0F0H        ; hard disk enable address
  00F6                   C      IDEDOR  EQU IDE+6       ; DIGITAL OUT REGISTER
  00F8                   C      IDEDAT  EQU IDE+8
  00F9                   C      IDEERR  EQU IDE+9
  00FA                   C      IDESCNT EQU IDE+0AH     ; SECTOR COUNTER
  00FB                   C      IDESNUM EQU IDE+0BH     ; SECTOR NUMBER
  00FC                   C      IDECLO  EQU IDE+0CH     ; CYLINDER LOW
  00FD                   C      IDECHI  EQU IDE+0DH     ; CYLINDER HIGH
  00FE                   C      IDESDH  EQU IDE+0EH     ; DRIVE UND HEAD
  00FF                   C      IDECMD  EQU IDE+0FH     ; /WR COMMAND
  00FF                   C      IDESTAT EQU IDECMD      ; /RD STATUS
                         C      
  0020                   C      CMD_READSEC     EQU 20H
  0030                   C      CMD_WRITESEC    EQU 30H
                         C      
                         C      ;-----------------
                         C      ; Call subprogram in bubble
                         C      ; 0,1,2,3,4,.......
        MACRO-80 3.43   27-Jul-81       PAGE    1-2


                         C      ;
  0001                   C      KEYIN   EQU 01H         ; KEYS INQUERY
  0002                   C      KEYOUT  EQU 02H         ; OUTPUT CHARACTER
                         C      ;
  0005                   C      P_READ  EQU 05H         ; HDD READ
  0006                   C      P_WRITE EQU 06H         ; HDD WRITE
  0007                   C      CPOS    EQU 07H         ; POSITION THE CURSOR
                         C      ; ENDE DEFINE
                                ;-----------------
                         C      INCLUDE BIOSSEL.MAC
                         C      ;--------------------------
                         C      ; BIOS Hardware CS Adresse
                         C      ;
  0018                   C      SIOA    EQU 18H         ; SIO A 84C43
  001A                   C      SIOB    EQU 1AH         ; SIO B 84C43
  0010                   C      CTC     EQU 10H         ; CTC BAUDRATE 84C30A
  001C                   C      PIOA    EQU 1CH         ; PIOA 84C20A
  001E                   C      PIOB    EQU 1EH         ; PIOB 84C20A
  00F0                   C      WDTCR   EQU 0F0H        ; WATCH DOG TIMER
  00F1                   C      WDTER   EQU 0F1H
  00F4                   C      DCI     EQU 0F4H        ; DAISY-CAINE-INTRRUPT
                         C      
  0020                   C      SDC     EQU 20H         ; MMC KATE
  0060                   C      LCD     EQU 60H         ; LCD-DISPAY
  0080                   C      URCS    EQU 80H         ; MIT 2K SRAM A0-A4 PIOA A5-A7
                         C      
  0040                   C      EOFF    EQU 40H         ; EPROM AUS RAM <32K AKTIV
  0021                   C      RAMH    EQU 21H         ; BIT1,5 PIOA BANK1
  0000                   C      RAML    EQU 00H         ; BIT1,5 PIOA BANK0
                                ;---------------
  F814                          READ    EQU 0F814H
  F817                          WRITE   EQU 0F817H
  F82F                          SETDMA  EQU 0F82FH
  F832                          SETTRK  EQU 0F832H
  F835                          SETSEC  EQU 0F835H
  F838                          SELDSK  EQU 0F838H
                                
  FFA2                          TASKSP  EQU 0FFA2H
  FFA4                          TRACKL  EQU TASKSP+2
  FFA5                          TRACKH  EQU TRACKL+1
  FFAB                          TRACK   EQU TRACKH+6
                                
                                        ;---------------------
                                        ;  CTC-COMMANDOS
                                        ;---------------------
                                
  0047                          BAUD1   EQU 47H         ;9600
  0004                          TIME1   EQU 04H         ; TIME CONSTANTE
                                
  0047                          BAUD2   EQU 47H         ; TGOT 1:2
  0004                          TIME2   EQU 04H         ;
                                
  0047                          BAUD3   EQU 47H         ; TGOT 1:2
  0004                          TIME3   EQU 04H         ;
                                
                                        ;--------------------
        MACRO-80 3.43   27-Jul-81       PAGE    1-3


                                        ;  SIO-COMMANDOS
                                        ;--------------------
                                
  0018                          SIORES  EQU 18H         ; SIO RESET
  0004                          KANAL4  EQU 04H         ; REG 4
  0044                          REG4    EQU 44H         ; X16 CLOCK,8,SYNC
  0003                          KANAL3  EQU 03H         ; REG 3
  00C1                          REG3    EQU 0C1H        ; 8BIT. RXENABLE
  0005                          KANAL5  EQU 05H         ; REG 5
  00EA                          REG5    EQU 0EAH        ; DTR,TX8BIT,TXENAL
  0001                          KANAL1  EQU 01H         ; REG 1
  0000                          REG1    EQU 00H         ; NO INT
  0000                          KANAL0  EQU 00H         ; REG 0
                                
                                        ;------------------
                                        ;  LCD INIT
                                        ;------------------
                                
  0005                          FSET    EQU 05H         ; FUNKTION SET
  000C                          DCON    EQU 0CH         ; DISPLAY CONTROL
  0001                          DCLR    EQU 01H         ; DISPLAY CLEAR
  0002                          DHOM    EQU 02H         ; DISPLAY HOME
                                
                                ;----------------
                                ;     START
                                ;----------------
                                ; PROGRAMM HOCHLADEN
                                
  0100    3E 00                 LOS:    LD A,00H        ; WAIT STATE CONTROL REGISTER SELECT
  0102    D3 EE                         OUT (0EEH),A
  0104    3E 01                         LD A,01H        ; WAIT STATE CONTROL REGISTER SET
  0106    D3 EF                         OUT (0EFH),A
  0108    31 5FFE                       LD SP,RAM-2
  010B    F3                            DI
  010C    3E 00                         LD A,00H        ; INTERRUPT PRIORITY REGISTER CTC-SIO-PIO
  010E    D3 F4                         OUT (DCI),A     ; INTERRUPT PRIORITY REGISTER
                                        ;----------------
                                        ; PROGRAMM AN ZIEHLEDRESSE "PROG" LADEN
  0110    21 0130                       LD HL,PRO       ; Programm Quelle+1 ab RUN:
  0113    11 7000                       LD DE,PROG      ; Programm Ziel
  0116    01 3000                       LD BC,3000H     ; RAM Laenge
  0119    ED B0                         LDIR                    ; Programm uebertragen
                                        ;------------
                                        ; KEY BUFFER EMPTY
  011B    21 6B27                       LD HL,RAMT
  011E    06 C8                         LD B,200D
  0120    3E 00                 LOS1:   LD A,00H
  0122    77                            LD (HL),A
  0123    23                            INC HL
  0124    10 FA                         DJNZ LOS1
                                ;------------
                                ; DRIVE NEU SET MASTER/SLAVE
                                ;
  0126    3A FD1A                       LD A,(0FD1AH)
  0129    FE A5                         CP 0A5H
  012B    3E F5                         LD A,0F5H
        MACRO-80 3.43   27-Jul-81       PAGE    1-4


                                        ;LD (0FD1AH),A
  012D    C3 7018                       JP RUN          ;PROGRAMM Start
                                ;----------------
  0130                          PRO:
                                
                                .PHASE PROG
                                
  7000    C9                    T0:     RET
  7001    00                            NOP
  7002    00                            NOP
  7003    C3 7B5B               T1:     JP TAS00                ; TASTENABFRAGE MIT SORTIERUNG
  7006    C3 7A0E               T2:     JP KEYST                ; TASTENABFRABE OHNE SORTIERUNG
  7009    C3 79EC               T3:     JP SUCH0                ; Blase mit Eintrag aus RAMT suchen  
  700C    C3 7A1F               T4:     JP LBA0                 ; Plattenzugriff (DE), (HL) +1
  700F    C3 7DE4               T5:     JP RDREAD               ; lesen einer Blase
  7012    C3 7E0D               T6:     JP RDWRITE              ; Speichern einer Blase
  7015    C3 7ABF               T7:     JP LIST                 ; CURSOR POS SET
                                ;--------------------------------
                                ;  LCD 128X128 ANSTEUERN
  7018    DB 1C                 RUN:    IN A,(PIOA)
  701A    CB BF                         RES 7,A         ; INTERN
  701C    D3 1C                         OUT (PIOA),A
                                ;--------------------
                                ; LCD128X128
                                ; INCLUDE LCD
                                ;
                                ;       CALL LCDINI 
                                ;---------------------
                                ;       LD A,AWRON
                                ;       CALL CMD
                                        ;
                                        ; LCD LOESCHEN, CLEAR
                                        ;
                                ;       PUSH HL
                                ;       LD HL,01A0H
                                ;TXCR:  LD A,20H        ;WRITE DATA 20 =SPACE (00)
                                ;       CALL ADT
                                ;       DEC HL
                                ;       LD A,H
                                ;       OR L
                                ;       JR NZ,TXCR
                                ;       POP HL
                                ;       LD A,AWROFF     ; AUTO RESET
                                ;       CALL CMD
                                        ;
                                        ; WRITE TEXT DISPLAY DATA (INTERNAL CG)
                                        ;
                                ;       LD HL,0000      ; ADDRESS POINTER 0lINE, 0COLUMN
                                ;       CALL DT2
                                ;       LD A,ADPSET
                                ;       CALL CMD
                                ;
                                ;       LD A,AWRON      ; SET DATA AUTO WRITE
                                ;       CALL CMD
                                ;
                                ;       LD HL,TEX3
        MACRO-80 3.43   27-Jul-81       PAGE    1-5


                                ;       LD B,TXL3
                                ;       CALL LCDA       ; TEXT AUSGEBEN
                                ;
                                ;       LD A,AWROFF
                                ;       CALL CMD
                                ;---------------------------------
                                ; Blasenspeicher mit Startadresse vorbereiten
                                
  701E    21 0000               KI:     LD HL,0000H
  7021    22 8096                       LD (BF07+2),HL
  7024    22 6502                       LD (BFRHL),HL           ; AKTUELL TRACK/SECTORADRESSE LADEN
                                        ; SORTIERE IN BFS...
  7027    22 650E                       LD (BFSHL),HL           ; IN BFS ADRESSE ZUM SORZIEREN
  702A    22 6512                       LD (BFSHL+4),HL
  702D    22 6512                       LD (LOGHL),HL
  7030    21 0010                       LD HL,0010H             ; STARTADR. USER-LOGIN AUF HDD
  7033    22 6510                       LD (LOGLL),HL
  7036    21 0800                       LD HL,HDD               ; HD STARTADRESSE
  7039    22 8094                       LD (BF07),HL
  703C    22 6500                       LD (BFRLL),HL           ; AKTUELLE TRACK/SECTORADRESSE LADEN
                                        ;-----------------------
                                        ; SORTIER STARTADRESSE SETZEN 
                                        ; BLASE1 UND BLASE2+4 AUS HDD STARTADRESSE+1
  703F    23                            INC HL          ; 
  7040    22 650C                       LD (BFSLL),HL   ; Sortieranfang
  7043    22 6510                       LD (BFSLL+4),HL ; Sortieranfang
                                
                                        ;------------------
                                        ; Cursor REGISTER auf Z=24, S=1 setzen
  7046    01 2401                       LD BC,2401H
  7049    CD 7ABF                       CALL LIST
                                        ;
                                        ;------------------
                                        ; BF00 beim Neustart auf Null setzen 
                                        ; Suchparameter fuer neue Blase 
                                        ; USER wird nur durch Login veraendert
                                        ; TYPE1, TYPE2 aus Blasendaten 
  704C    AF                            XOR A
  704D    32 806C                       LD (BF00),A
  7050    32 806D                       LD (BF00+RUSER),A
  7053    32 806E                       LD (BF00+RTYPE1),A
  7056    32 806F                       LD (BF00+RTYPE2),A
  7059    32 8070                       LD (BF00+RTERM),A
                                        ;----------
  705C    C5                            PUSH BC
  705D    D5                            PUSH DE
  705E    E5                            PUSH HL
  705F    21 80AB               COL0:   LD HL,COL01             ; BILDSCHIRM FARBE
  7062    06 09                         LD B,09D                ; AUSGABELAENGE
  7064    7E                    COL1:   LD A,(HL)
  7065    CD 78F3                       CALL HEXC
  7068    23                            INC HL
  7069    10 F9                         DJNZ COL1
  706B    E1                            POP HL
  706C    D1                            POP DE
  706D    C1                            POP BC
        MACRO-80 3.43   27-Jul-81       PAGE    1-6


                                ;       JR KI1          ;!!STARTSEITE NICHT DA ->
                                        ;---
                                        ; Blase aus BFRxx laden
  706E    AF                    BL:     XOR A
  706F    ED 4B 6500                    LD BC,(BFRLL)   ; Aktuelle HIGH LBA laden
  7073    ED 5B 6502                    LD DE,(BFRHL)   ; Aktuelle LOW LBA laden
  7077    21 6000                       LD HL,RAM       ; DMA
  707A    CD 7DE4                       CALL RDREAD
                                        ;------
                                        ; READ SICHTBAR MACHEN
                                ;!!!    LD BC,0501H
                                ;!!!    CALL LIST
                                ;!!!    LD HL,RAM
                                ;!!!    CALL LIS0
  707D    3A 6000                       LD A,(RAM)
  7080    FE 43                         CP 43H
  7082    CA 7090                       JP Z,KI1
                                        ;-------------------
  7085    21 8439                       LD HL,SMASKE            ; STARTMASKE LADEN
  7088    11 6000                       LD DE,RAM
  708B    01 0083                       LD BC,SRAL
  708E    ED B0                         LDIR
  7090    3E 0A                 KI1:    LD A,0AH        ; >9
  7092    32 80A6                       LD (DAYZ+3),A   ; UHRZEIT LOESCHEN DAMIT GLEICH AUSGEGEBEN WIRD
                                ;       JP 0;!!!
                                        ;------------
                                        ; Blasenstatus schon mal auf benutzt setzen
                                        ; IN AKTUELLER BLASE RAM
  7095    3A 6005                       LD A,(RAM+RBSTAT)       ; RAM
  7098    CB FF                         SET 7,A         ; GedankenStatus Zaehler 0= minus 1= plus
  709A    CB B7                         RES 6,A         ; Sortieren aktivieren
  709C    32 6005                       LD (RAM+RBSTAT),A       ; AUS AKTUELLER BLASE
                                ; ???
  709F    3A 6205                       LD A,(BLAN+RBSTAT)      ; RAM+200
  70A2    CB FF                         SET 7,A         ; Gedankenzaehler 0= minus 1= plus
  70A4    CB B7                         RES 6,A         ; Sortieren aktivieren
  70A6    32 6205                       LD (BLAN+RBSTAT),A      ; VORBEREITEN
                                ; ???
                                        ;---------------------------------
                                        ;  gebe die laenge von B auf VT100 Bildschirm aus 
  70A9    21 6000               BL00:   LD HL,RAM       ; AB HEIR SPEICHER BESCHREIBEN
  70AC    22 6524                       LD (RADR),HL    ; Aktuelle Blasenadresse zwischenspeichern
  70AF    4E                            LD C,(HL)       ; Anzahl von Zeichen ausgeben
  70B0    79                            LD A,C
  70B1    32 6526                       LD (RMEN),A     ; Zeichen laenge zwischenspeichern
  70B4    AF                            XOR A
  70B5    11 6000                       LD DE,RAM
  70B8    ED 52                         SBC HL,DE       ; Blasenanfang bestimmen
  70BA    2A 6524                       LD HL,(RADR)
  70BD    20 09                         JR NZ,BL000     ; NICHT NOCH KEIN BLASENANFANG ->
  70BF    23                            INC HL          ; USER
  70C0    23                            INC HL          ; TYPE1
  70C1    7E                            LD A,(HL)
  70C2    32 806E                       LD (BF00+RTYPE1),A
  70C5    23                            INC HL          ; Type2
  70C6    23                            INC HL          ; Gedaechtniszaehler
        MACRO-80 3.43   27-Jul-81       PAGE    1-7


  70C7    23                            INC HL          ; Status Byte
  70C8    3A 6526               BL000:  LD A,(RMEN)
  70CB    47                            LD B,A
  70CC    AF                            XOR A           ; LOESCHEN
  70CD    B8                            CP B
  70CE    CA 7580                       JP Z,EING       ; SPEUNG ZUR EINGABE wenn Zeichenlaenge =0
                                        ;--------------------------------
                                        ; Block ausgeben
  70D1    E5                            PUSH HL
  70D2    D5                            PUSH DE
  70D3    C5                            PUSH BC
  70D4    01 0101                       LD BC,0101H
  70D7    CD 7ABF                       CALL LIST
  70DA    C1                            POP BC
  70DB    D1                            POP DE
  70DC    E1                            POP HL
  70DD    23                    BL01:   INC HL          ; ab hier Grafik/Text Bereich
  70DE    7E                            LD A,(HL)       ; Speicher Lesen 
  70DF    CD 78F3                       CALL HEXC       ; und ausgeben 
  70E2    10 F9                         DJNZ BL01
                                        ;
                                        ;---------------------------
                                        ; Blasen Parameter USER,TYPE1,TYPE2,Gedaechtnis in % Anzeigen
                                        ; OBEN RECHTS Z=1, S=60
  70E4    E5                            PUSH HL
  70E5    D5                            PUSH DE
  70E6    C5                            PUSH BC
  70E7    01 0160                       LD BC,0160H     ; AUSGABE ZEILE/SPALTE
  70EA    CD 7ABF                       CALL LIST
  70ED    C1                            POP BC
  70EE    21 6001                       LD HL,RAM+RUSER         ; USER AUS AKTUELLER BLASE
  70F1    C5                            PUSH BC
  70F2    4E                            LD C,(HL)
  70F3    C5                            PUSH BC
  70F4    CD 7850                       CALL HEX14      ; USER / %
  70F7    C1                            POP BC
  70F8    C1                            POP BC
  70F9    2A 6002                       LD HL,(RAM+RTYPE1)      ; TYPE2=L ,TYPE1=H LADEN
                                        ;---------------------
                                        ; GED[CHTNISZ[HLER IN % UMRECHEN
  70FC    3A 6004                       LD      A,(RAM+RTERM)   ; GED[CHTMISZ[HLER LADEN
  70FF    5F                            LD      E,A     
  7100    3E 00                         LD      A,00H
  7102    F5                    EZ03:   PUSH    AF
  7103    7B                            LD      A,E
  7104    D6 02                         SUB     02H
  7106    FE 03                         CP      03h
  7108    38 28                         JR      C,EZ04
  710A    28 26                         JR      Z,EZ04
  710C    5F                            LD      E,A
  710D    F1                            POP     AF
  710E    3C                            INC     A
  710F    27                            DAA
  7110    F5                            PUSH    AF
  7111    7B                            LD      A,E
  7112    D6 03                         SUB     03H
        MACRO-80 3.43   27-Jul-81       PAGE    1-8


  7114    FE 03                         CP      03H
  7116    38 1A                         JR      C,EZ04
  7118    28 18                         JR      Z,EZ04
  711A    5F                            LD      E,A
  711B    F1                            POP     AF
  711C    3C                            INC     A
  711D    27                            DAA
  711E    CB 47                         BIT     0,A
  7120    28 E0                         JR      Z,EZ03
  7122    F5                            PUSH    AF
  7123    7B                            LD      A,E
  7124    D6 03                         SUB     03H
  7126    FE 03                         CP      03H
  7128    38 08                         JR      C,EZ04
  712A    28 06                         JR      Z,EZ04
  712C    5F                            LD      E,A
  712D    F1                            POP     AF
  712E    3C                            INC     A
  712F    27                            DAA
  7130    18 D0                         JR      EZ03
                                        ;-------------------
  7132    F1                    EZ04:   POP AF
  7133    C5                            PUSH BC
  7134    4F                            LD C,A
  7135    C5                            PUSH BC
  7136    CD 7850                       CALL HEX00              ; % WERT AUSGEBEN
  7139    C1                            POP BC
  713A    C1                            POP BC
  713B    3E 25                         LD A,'%'                ; % ALS ZEICHEN
  713D    CD 78F3                       CALL HEXC
  7140    D1                            POP DE
  7141    E1                            POP HL
                                        ;-------------------------------
                                        ;       Tasten Zeichen Eingeben
                                
  7142    23                            INC     HL              ; naechster Block
  7143    46                            LD      B,(HL)          ; Eingabelaenge 
  7144    E5                            PUSH    HL
  7145    21 6B27                       LD      HL,RAMT         ; RAMT Zeichen Buffer Eingaben
  7148    11 6B27                       LD      DE,RAMT
  714B    13                            INC     DE              ; fuer erstes Zeichen
  714C    AF                            XOR     A
  714D    77                            LD      (HL),A          ; Eingabe Zeichenzaehler auf Null setzen
  714E    B8                            CP      B
  714F    CA 7217                       JP      Z,BL03          ; SPEUNG ZUR EINGABE OHNE GRAFIK AUSGABE 
                                        ;--------------------------
                                        ; Eingabezeile ausgeben
  7152    D5                            PUSH DE
  7153    E5                            PUSH HL         ; Grafik/Text 
  7154    C5                            PUSH BC
  7155    3A 6003                       LD A,(RAM+RTYPE2)
  7158    FE 00                         CP 0H
  715A    C2 716E                       JP NZ,EZ02
  715D    21 80C0                       LD HL,EBUFF
  7160    06 44                         LD B,EZLEN
  7162    7E                    EZ01:   LD A,(HL)
        MACRO-80 3.43   27-Jul-81       PAGE    1-9


  7163    CD 78F3                       CALL HEXC
  7166    7E                            LD A,(HL)
  7167    FE 3A                         CP ':'          ; FRUEHER ENDE
  7169    28 03                         JR Z,EZ02
  716B    23                            INC HL
  716C    10 F4                         DJNZ EZ01
  716E    C1                    EZ02:   POP BC
  716F    E1                            POP HL
  7170    D1                            POP DE
  7171    CD 7902                       CALL CON                ; CURSOR ON
  7174    C5                    BL02:   PUSH BC
  7175    D5                            PUSH DE
  7176    E5                            PUSH HL
  7177    CD 7AF8                       CALL TAS                ; auf Zeichen Warten
  717A    E1                            POP HL
  717B    D1                            POP DE
  717C    C1                            POP BC
  717D    12                            LD (DE),A               ; Zeichen abspeichen
  717E    FE 0D                         CP 0DH
  7180    CA 7217                       JP Z,BL03               ; Ausgang mit CR
  7183    FE 08                         CP 08H          ; TAB
  7185    20 1F                         JR NZ,BL021     ; NEIN ->
                                        ;-----------------
                                        ; BACKSPACE FUNKTION CURSOR LINKS MIT ZEICHEN LOESCHEN
                                        ;
  7187    7E                            LD      A,(HL)          ; Zeichenzaehler
  7188    D6 01                         SUB     01H
  718A    DA 7215                       JP      C,BL023
  718D    77                            LD      (HL),A          ; Zeichenlaenge -1
  718E    3E 20                         LD      A,20H
  7190    CD 78F3                       CALL    HEXC
  7193    04                            INC     B
  7194    1B                            DEC     DE              ; Zeichen loeschen
  7195    3E 1B                         LD      A,1BH
  7197    CD 78F3                       CALL    HEXC
  719A    3E 5B                         LD      A,5BH
  719C    CD 78F3                       CALL    HEXC
  719F    3E 44                         LD A,44H
  71A1    CD 78F3                       CALL HEXC
  71A4    18 CE                         JR BL02         ; zurueck ohne B dec
                                        ;-------------------
                                        ; 
  71A6    FE 1B                 BL021:  CP 1BH          ; ESC
  71A8    20 65                         JR NZ,BL022     ; NEIN ->
  71AA    7E                            LD A,(HL)
  71AB    FE 00                         CP 0H
  71AD    20 60                         JR NZ,BL022
  71AF    D5                            PUSH DE
  71B0    C5                            PUSH BC
  71B1    E5                            PUSH HL
  71B2    06 A0                 BL120:  LD B,0A0H
  71B4    10 FE                         DJNZ $
  71B6    0E 0B                         LD C,0BH        ; GET CONSOLE STATUS
  71B8    CD 0005                       CALL 0005H      ; pruefe ob Zeichen da
  71BB    FE 00                         CP 0H
  71BD    28 46                         JR Z,BL121      ; -> NO
        MACRO-80 3.43   27-Jul-81       PAGE    1-10


  71BF    0E 01                         LD C,01H        ; CONSOLE INPUT
  71C1    CD 0005                       CALL 0005H      ; ZEICHEN HOLEN
  71C4    5F                            LD E,A
  71C5    FE 5B                         CP '['
  71C7    28 E9                         JR Z,BL120
  71C9    3E 44                         LD A,'D'
  71CB    BB                            CP E
  71CC    38 37                         JR C,BL121
  71CE    3E 40                         LD A,'@'
  71D0    BB                            CP E
  71D1    30 32                         JR NC,BL121
  71D3    3E 41                         LD A,'A'
  71D5    BB                            CP E
  71D6    20 0D                         JR NZ,BL123
  71D8    3A 80A9                       LD A,(ZEIL)
  71DB    3C                            INC A
  71DC    FE 07                         CP CURUD
  71DE    30 25                         JR NC,BL121
  71E0    32 80A9                       LD (ZEIL),A
  71E3    18 20                         JR BL121
                                ;--------------------------     
  71E5    3E 42                 BL123:  LD      A,'B'
  71E7    BB                            CP      E
  71E8    20 0D                         JR      NZ,BL124
                                        ;LD     A,'B'
                                        ;CP     E
                                        ;JR     NZ,BL123
  71EA    3A 80A9                       LD      A,(ZEIL)
  71ED    3D                            DEC     A
  71EE    FE 01                         CP      01H
  71F0    38 13                         JR      C,BL121
  71F2    32 80A9                       LD      (ZEIL),A
  71F5    18 0E                         JR      BL121
                                        ;-------------------
                                
  71F7    3E 43                 BL124:  LD      A,'C'
  71F9    BB                            CP      E
  71FA    20 02                         JR      NZ,BL125
                                ; Cursor right
  71FC    18 07                         JR      BL121
                                        ;-----------
  71FE    3E 44                 BL125:  LD      A,'D'
  7200    BB                            CP      E
  7201    20 02                         JR      NZ,BL121
                                ; Cursor left
  7203    18 AD                         JR      BL120
                                        ;------------
  7205    AF                    BL121:  XOR     A               ; letzes Zeichen loeschen
  7206    E1                            POP     HL
  7207    C1                            POP     BC
  7208    D1                            POP     DE
  7209    77                            LD      (HL),A          ; Zeichenzaehler loeschen
  720A    18 03                         JR      BL022
  720C    C3 7174               BL02X:  JP      BL02
                                        ;-------------
  720F    FE 21                 BL022:  CP      21H             ; Zeichen < Space
        MACRO-80 3.43   27-Jul-81       PAGE    1-11


  7211    38 02                         JR      C,BL023
  7213    13                            INC     DE              ; Zeichenadr. +1
  7214    34                            INC     (HL)            ; Zeichenzaehler erhoehen
  7215    10 F5                 BL023:  DJNZ    BL02X           ; vorgegebene Laenge aus Blase
                                
                                ;-----------------------
                                ; Programm ausfuehrung
                                
  7217    E1                    BL03:   POP     HL              ; zurueck zur aktuellen RAM adre.
  7218    7E                            LD      A,(HL)          ; Pruefe ob Zeiche ??Programmaufruf da 
  7219    23                            INC     HL              ; weiter zur Programmanzahl     
  721A    FE 00                         CP      00H
  721C    28 0A                         JR      Z,BL031         ; kein Zeichen gedrueckt
  721E    3A 6B27                       LD      A,(RAMT)
  7221    FE 00                         CP      00H
  7223    20 0D                         JR      NZ,BL030
  7225    C3 70A9                       JP      BL00            ; kein Zeichen gedruekt
                                        ;------------------------
  7228    3E 01                 BL031:  LD      A,01H           ; sonst Zeichenzaehler auf 1 setzen
  722A    32 6B27                       LD      (RAMT),A        ; 
  722D    3E 31                         LD      A,31H           ; Programme mindest 1
  722F    32 6B28                       LD      (RAMT+1),A      ; Programmzaehler
  7232    46                    BL030:  LD      B,(HL)          ; Anzahl von Programmaufrufe aus Blase
  7233    AF                            XOR     A               ; LOESCHEN
  7234    B8                            CP      B
  7235    CA 733B                       JP      Z,BL14          ; SPEUNG 
                                        ;--------------
  7238    3A 6B27                       LD A,(RAMT)     ; Anzahl der Taste 
  723B    FE 02                         CP 02H
  723D    D2 733B                       JP NC,BL14              ; Taste mehr als eine Stelle
  7240    3A 6B28                       LD A,(RAMT+1)   ; gedruektes Taste = Zeichen
  7243    FE 30                         CP 30H
  7245    28 19                         JR Z,TEING              ; ??Aender moeglich machen mit 0
  7247    FE 39                         CP 39H                  ; 9 ENDE
  7249    20 05                         JR NZ,BL033
  724B    0E 00                 EXIT:   LD C,00H
  724D    C3 8020                       JP EPROMON
                                ;-------
  7250    FE 3A                 BL033:  CP      3AH             ; nicht > 9
  7252    D2 70A9                       JP      NC,BL00
  7255    D6 30                         SUB     30H             ; nicht < 1
  7257    DA 70A9                       JP      C,BL00
  725A    47                            LD      B,A             ; Welche Programm in A 1 - 9
  725B    22 6524                       LD      (RADR),HL       ; aktuelle RAM Adresse retten 
  725E    18 0C                         JR      BL131
                                        ;-------------------
                                        ; AENDERUNG NUR IN TYPE2 =0 MOEGLICH
  7260    3A 6003               TEING:  LD      A,(RAM+RTYPE2)
  7263    FE 00                         CP      0H
  7265    CA 7580                       JP      Z,EING
  7268    C3 70A9                       JP      BL00
                                
                                        ;-----------------
                                        ; Programm suchen und Starten
  726B    19                            ADD     HL,DE
  726C    11 000D               BL131:  LD      DE,000DH        ; Laenge einer Datei
        MACRO-80 3.43   27-Jul-81       PAGE    1-12


  726F    10 FA                         DJNZ    BL131-1 
  7271    11 0080               BL132:  LD      DE,BUFF         ; <- Zurueck von Zeilen-Prog.aufruf
  7274    23                            INC     HL
  7275    7E                            LD      A,(HL)
  7276    FE 00                         CP      0H
  7278    CA 70A9                       JP      Z,BL00
  727B    12                            LD      (DE),A
  727C    13                            INC     DE
  727D    E6 0F                         AND     0FH
  727F    47                            LD      B,A             ; Laenge der Datei auslesen
  7280    CD 7289                       CALL    BL13
  7283    DA 731D                       JP      C,BL830         ; ERROR DATEI NICHT GEFUNDEN
  7286    C3 7314                       JP      BL84
                                        ;-------------------
                                        ; PROGRAMM AUS (HL) ]BERNEHMEM UND LADEN
                                        ; B= LAENGE DES DATEINAMEN
                                        ; (HL) DATEINAME.COM
                                        ; NACH (DE) BUFFER COPIEREN 
                                
  7289    23                    BL13:   INC     HL
  728A    7E                            LD      A,(HL)
  728B    12                            LD      (DE),A
                                        ;CALL HEXC      ;!!! PROGRAMM NAME SICHTBAR MACHEN ZUM TEST
  728C    13                            INC     DE
  728D    10 FA                         DJNZ    BL13
  728F    AF                            XOR     A
  7290    12                            LD      (DE),A
                                        ;------------------
                                        ;
  7291    11 005D                       LD      DE,FCBFN
  7294    3E 20                         LD      A,20H
  7296    06 0B                         LD      B,0BH
  7298    12                    BL23:   LD      (DE),A
  7299    13                            INC     DE
  729A    10 FC                         DJNZ    BL23
  729C    3E 00                         LD      A,00H
  729E    06 08                         LD      B,08H
  72A0    12                    BL231:  LD      (DE),A
  72A1    13                            INC     DE
  72A2    10 FC                         DJNZ    BL231
                                        ;--------------
                                
  72A4    E5                            PUSH    HL
  72A5    11 005C                       LD      DE,FCB
  72A8    AF                            XOR     A
  72A9    12                            LD      (DE),A
  72AA    13                            INC     DE
  72AB    21 0080                       LD      HL,BUFF
  72AE    46                            LD      B,(HL)
  72AF    23                            INC     HL
  72B0    7E                    BL33:   LD      A,(HL)
  72B1    FE 2E                         CP      2EH
  72B3    20 06                         JR      NZ,BL43
  72B5    23                            INC     HL
  72B6    11 0065                       LD      DE,FCBFT
  72B9    18 F5                         JR      BL33    
        MACRO-80 3.43   27-Jul-81       PAGE    1-13


                                
  72BB    12                    BL43:   LD      (DE),A
  72BC    13                            INC     DE
  72BD    23                            INC     HL
  72BE    10 F0                         DJNZ    BL33
                                
                                        ;---------------
                                
  72C0    CD 7990                       CALL IDERES
  72C3    AF                            XOR     A
  72C4    06 14                         LD      B,14H
  72C6    12                    BL53:   LD      (DE),A
  72C7    13                            INC     DE
  72C8    10 FC                         DJNZ    BL53
  72CA    1E 04                         LD E,SELDM              ; MASTER DISK
  72CC    0E 0E                         LD C,14D
  72CE    CD 0005                       CALL 0005H              ; BEZUGSLAUFWERK LW-NUMMER
  72D1    E5                            PUSH    HL
  72D2    AF                            XOR     A
  72D3    32 006B                       LD      (FCBCR),A       ; cr loeschen
  72D6    11 005C                       LD      DE,FCB
  72D9    0E 0F                         LD      C,0FH
  72DB    CD 0005                       CALL    0005H
  72DE    FE FF                         CP      0FFH
  72E0    20 04                         JR      NZ,BL73         ; ->kein Fehler POP HL fehlt
  72E2    E1                            POP     HL
  72E3    E1                            POP     HL              ; Adresse zurueck
  72E4    37                            SCF
  72E5    C9                            RET
                                
                                        ;--------------------
                                        ;  Dateisatz lesen
                                
  72E6    3A 007C               BL73:   LD      A,(FCBRA)
  72E9    11 0100                       LD      DE,0100H        ; DMA Buffer
  72EC    FE 00                 BL736:  CP      00H
  72EE    28 09                         JR      Z,BL83
  72F0    3D                            DEC     A
  72F1    21 0080                       LD      HL,0080H
  72F4    19                            ADD     HL,DE
  72F5    E5                            PUSH    HL
  72F6    D1                            POP     DE              ; HL nach DE kopieren
  72F7    18 F3                         JR      BL736
  72F9    0E 1A                 BL83:   LD      C,1AH           ; Datenbuffer festlegen
  72FB    CD 0005                       CALL    0005H           ; CCP
  72FE    E5                            PUSH    HL
  72FF    D5                            PUSH    DE
  7300    C5                            PUSH    BC
  7301    11 005C                       LD      DE,FCB
  7304    0E 14                         LD      C,14H
  7306    CD 0005                       CALL    0005H           ; Datei laden
  7309    C1                            POP     BC
  730A    D1                            POP     DE
  730B    E1                            POP     HL
  730C    FE 00                         CP      00H
  730E    28 D6                         JR      Z,BL73          ; wiederhole bie Datei geladen
        MACRO-80 3.43   27-Jul-81       PAGE    1-14


  7310    E1                            POP     HL              ; wenn bei BL53: kein Fehler RAM weiter
  7311    E1                            POP     HL              ; Adresse zurueck
  7312    AF                            XOR     A
  7313    C9                            RET
                                        ;---------------
                                        ; GEFUNDENES PROGRAMM STARTEN
                                
  7314    E5                    BL84:   PUSH    HL
  7315    D5                            PUSH    DE
  7316    C5                            PUSH    BC
  7317    CD 0100                       CALL    0100H
  731A    C1                            POP     BC
  731B    D1                            POP     DE
  731C    E1                            POP     HL
                                        ;------------------
                                        ; Ende der Programme berechnen
  731D    2A 6524               BL830:  LD      HL,(RADR)
  7320    46                            LD      B,(HL)
  7321    04                            INC     B
  7322    18 01                         JR      BL831
  7324    19                            ADD     HL,DE
  7325    11 000D               BL831:  LD      DE,000DH                ; Laenge einer Datei
  7328    10 FA                         DJNZ    BL831-1 
  732A    23                            INC     HL
                                        ;-----------------
                                        ; Sprungadresse in I/O-RAM (0) Laden
                                
  732B    3A 6200               BL04:   LD      A,(BLAN)        ; Rueckmeldung aus Unterprogramm
  732E    FE 00                         CP      00H
  7330    CA 70A9                       JP      Z,BL00          ; Blase neu starten
  7333    FE 01                         CP      01H
  7335    CA 70AC                       JP      Z,BL00+3        ; naechster Block 
  7338    C3 70A9                       JP      BL00            ; weiter mit RAM
                                ;---------------------------
                                ; Aktuelle Blase im RAM nach Begriff durchsuchen
                                
  733B    3A 6001               BL14:   LD      A,(RAM+1)       ; Type1
  733E    47                            LD      B,A
                                ;??     LD      A,(USER) TYPE1
  733F    B8                            CP      B
  7340    CA 7343                       JP      Z,BS10          ; gefunden
                                ;---------------------------
                                ;  Blase vom Anfang aus nach RAMR laden und Text suchen
                                 
  7343    3A 806D               BS10:   LD A,(BF00+RUSER)       ; UEBERNEHMEN
  7346    32 8099                       LD (BF10+RUSER),A       ; loeschen 
  7349    3A 806E                       LD A,(BF00+RTYPE1)      ; uebernehmen
  734C    32 809A                       LD (BF10+RTYPE1),A      ; loeschen 
  734F    3A 806F                       LD A,(BF00+RTYPE2)      ; uebernehmen 
  7352    32 809B                       LD (BF10+RTYPE2),A      ; loeschen 
  7355    32 809C                       LD (BF10+RTERM),A       ; loeschen 
  7358    32 809D                       LD (BF10+RBSTAT),A      ; loeschen 
  735B    AF                            XOR A
  735C    32 650B                       LD (BFVHH),A    ; Aktuelle Track/Sectoradresse laden
  735F    32 650A                       LD (BFVHL),A
  7362    21 0801                       LD HL,HDD+1     ; Startadresse
        MACRO-80 3.43   27-Jul-81       PAGE    1-15


  7365    22 6508                       LD (BFVLL),HL   ; Aktuelle Track/Sectoradresse laden
                                ;-------------------------
                                ; Blase zum vergleich laden und Text in Speicher suchen
                                
  7368    C5                    SU00:   PUSH BC
  7369    D5                            PUSH DE
  736A    E5                            PUSH HL
  736B    CD 7913                       CALL COFF
  736E    06 50                         LD B,80D
  7370    21 6B27                       LD HL,RAMT
  7373    11 6BEF                       LD DE,RTEX
  7376    7E                    STX01:  LD A,(HL)
  7377    12                            LD (DE),A
  7378    23                            INC HL
  7379    13                            INC DE
  737A    10 FA                         DJNZ STX01
  737C    ED 4B 6508            SU01:   LD BC,(BFVLL)
  7380    ED 5B 650A                    LD DE,(BFVHL)           ; Suchadresse 
  7384    21 6527                       LD HL,RAMV
  7387    CD 7DE4                       CALL RDREAD             ; AKTUELLE BLASE LADEN
                                        ; READ SICHTBAR MACHEN
  738A    01 1501                       LD BC,1501H
  738D    CD 7ABF                       CALL LIST
  7390    21 6527                       LD HL,RAMV
  7393    CD 7AEB                       CALL LIS0
                                        ;------
                                ;----------
  7396    E5                            PUSH HL
  7397    21 0801                       LD HL,HDD+1
  739A    22 6510                       LD (BFSLL+4),HL
  739D    21 0000                       LD HL,0000H
  73A0    22 6512                       LD (BFSHL+4),HL
  73A3    E1                            POP HL
                                        ;---------------------
                                        ; Cursor drehen lassen und
                                        ; nach Abstand gefundener Zeichen setzen
  73A4    CD 7EAC                       CALL UHR00
  73A7    3E 32                         LD      A,32H
  73A9    32 651C                       LD      (CURT),A
  73AC    3E 34                         LD      A,34H
  73AE    32 651D                       LD      (CURT+1),A
  73B1    3E 32                         LD      A,32H
  73B3    32 651E                       LD      (CURT+2),A
  73B6    3A 6B27                       LD      A,(RAMT)
  73B9    C6 30                         ADD     A,30H           ; 
  73BB    FE 3A                         CP      3AH
  73BD    38 0E                         JR      C,SU02
  73BF    D6 0A                         SUB     0AH
  73C1    32 651F                       LD      (CURT+3),A
  73C4    3A 651E                       LD      A,(CURT+2)
  73C7    3C                            INC     A
  73C8    32 651E                       LD      (CURT+2),A
  73CB    18 03                         JR      SU03
  73CD                          SU02:   ;LD     A,35H
  73CD    32 651F                       LD      (CURT+3),A
                                        ;------------------------
        MACRO-80 3.43   27-Jul-81       PAGE    1-16


                                        ; vergleich, suche nach Blasen beginnen
                                
  73D0    CD 788D               SU03:   CALL    CUT
  73D3    21 6527                       LD      HL,RAMV         ; in Blase suchen mit
  73D6    11 6B27                       LD      DE,RAMT         ; Textanfang 1. Zeichen
  73D9    1A                            LD      A,(DE)          ; neue TextLAENGE mit
  73DA    FE 02                         CP      02H             ; Suchtext muss > 1 Zeichen sein
  73DC    DA 753B                       JP      C,SU52          ; Ausgang ohne suchtext
  73DF    23                            INC     HL              ; ZU USER 
  73E0    3A 806D                       LD      A,(BF00+RUSER)  ; Aus sichtbarer aktuel Blase
  73E3    BE                            CP      (HL)            ; RAMV VERGLEICH MIT USER IN BLASE 
                                        ;JP     Z,SU80          ; User mit Blase ist gleich 
                                        ;JP     NC,SU62         ; ERST IN USER+1 LEERE BLASE SUCHEN
  73E4    3A 652B               SU04:   LD      A,(RAMV+RTERM)  ; Gedaechtnisszaehler
  73E7    FE FF                         CP      0FFH            ; nach leerer ,abgelaufener Blase 
  73E9    C2 74B1                       JP      NZ,SU62         ; noch nicht leer, abgelaufen
  73EC    3A 6003                       LD      A,(RAM+RTYPE2)  ; MUSS BLASENANFANG SEIN
  73EF    FE 00                         CP      0H              ; nach leerer ,abgelaufener Blase 
  73F1    C2 753B                       JP      NZ,SU52         ; noch nicht leer, abgelaufen
                                ;-----------------------
                                ; neue Blase Eroeffnen mit Eingabetext 
                                ; als Ueberschrift
                                ;
                                ;---------------
                                ; Blasenadr. BFVxx mit BFRxx tauschen (HL)->(DE)
                                                
  73F4    11 6500                       LD DE,BFRLL     ; Aktuelle Blaseadresse ersetzen durch
  73F7    21 6508                       LD HL,BFVLL     ; Leere gefundene Blase
  73FA    EB                            EX DE,HL        ; TAUSCHEN
                                        ;----------------
                                
  73FB    3A 809B                       LD      A,(BF10+RTYPE2)
  73FE    FE 00                         CP      0H
  7400    28 19                         JR      Z,SU85
  7402    06 19                         LD      B,25D           ; laenge DES KOPFTEXT AUS Blase einkopieren
  7404    11 601B                       LD      DE,RAM+1BH      ; Adr. Aktueller Blase
  7407    21 83FC                       LD      HL,TBLASE+1BH   ; Textblock leerer Blase
  740A    1A                    SU88:   LD      A,(DE)
  740B    77                            LD      (HL),A
  740C    23                            INC     HL
  740D    13                            INC     DE
  740E    10 FA                         DJNZ    SU88
  7410    06 58                         LD      B,TBLLE         ; laenge neuer Blase einkopieren
  7412    11 6000                       LD      DE,RAM          ; Adr. Aktueller Blase
  7415    21 83E1                       LD      HL,TBLASE       ; Textblock leerer Blase
  7418    C3 7423                       JP      SU82
                                
  741B    06 A3                 SU85:   LD      B,NBLLE         ; laenge neuer Blase einkopieren
  741D    11 6000                       LD      DE,RAM          ; Adr. Aktueller Blase
  7420    21 833E                       LD      HL,NBLASE       ; Textblock leerer Blase
  7423    7E                    SU82:   LD      A,(HL)          ; kopieren
  7424    12                            LD      (DE),A
  7425    23                            INC     HL
  7426    13                            INC     DE
  7427    10 FA                         DJNZ    SU82
  7429    11 6001                       LD      DE,RAM+1        ; Aktuelle USER
        MACRO-80 3.43   27-Jul-81       PAGE    1-17


                                
                                        ;----------------
                                        ; Ueberschrift aus suchtext einsetzen
  742C    3A 6B27                       LD      A,(RAMT)
  742F    47                            LD      B,A             ; Textlaenge in B
  7430    11 6000                       LD      DE,RAM
  7433    13                    SU83:   INC     DE              ; Nach Space 20H suchen erstes Zeichen
  7434    1A                            LD      A,(DE)
  7435    FE 20                         CP      20H
  7437    20 FA                         JR      NZ,SU83
                                        ;-----------------
  7439    21 6B28                       LD      HL,RAMT+1       ; erstes Zeichen
  743C    7E                    SU84:   LD      A,(HL)          ; uebertrageb bis B=0
  743D    12                            LD      (DE),A
  743E    23                            INC     HL
  743F    13                            INC     DE
  7440    10 FA                         DJNZ    SU84
                                        ;-----------------      
                                        ; BF10 IN NEU GEFUNDENE BLASE ]BERNEHMEN
                                        ; RUSER, RTYPE1+1, RTYPE2
                                
  7442    3A 8099                       LD      A,(BF10+RUSER)
  7445    32 6001                       LD      (RAM+RUSER),A   ; Aktueller USER uebernehmen
  7448    3A 809B                       LD      A,(BF10+RTYPE2)
  744B    FE 00                         CP      0
  744D    28 0B                         JR      Z,SU86
  744F    3A 806E                       LD      A,(BF00+RTYPE1) ; uebernehmen 
  7452    32 6002                       LD      (RAM+RTYPE1),A  ; uebernehmen 
  7455    3A 809B                       LD      A,(BF10+RTYPE2) ; uebernehmen 
                                        ;LD     (RAM+RTYPE2),A  ; uebernehmen 
  7458    18 0D                         JR      SU87    
  745A    3A 809A               SU86:   LD      A,(BF10+RTYPE1) ; uebernehmen 
  745D    3C                            INC     A
  745E    32 6002                       LD      (RAM+RTYPE1),A  ; uebernehmen 
  7461    3A 809B                       LD      A,(BF10+RTYPE2) ; uebernehmen 
  7464    32 6003                       LD      (RAM+RTYPE2),A  ; uebernehmen 
                                        ;------------------
  7467    E1                    SU87:   POP     HL
  7468    D1                            POP     DE
  7469    C1                            POP     BC
  746A    C3 70A9                       JP      BL00
                                        ; ENDE neue Blase anspringen
                                        ;--------------------------
                                        ; weiter vergleichen
                                
  746D    23                    SU80:   INC     HL              ; zu TYPE1 in RAMV
  746E    23                            INC     HL              ; ZU TYPE2 IN RAMV
  746F    3A 809B                       LD      A,(BF10+RTYPE2)
                                        ;CP     (HL)
  7472    B6                            OR      (HL)
  7473    CA 74F4                       JP      Z,SU90
  7476    23                            INC     HL              ; Gedaechtnisz. TERM 
  7477    3A 809C                       LD      A,(BF10+RTERM)  ; 
  747A    BE                            CP      (HL)
  747B    CA 74B1                       JP      Z,SU62          ; nicht =1
  747E    23                            INC     HL              ; Status Byte
        MACRO-80 3.43   27-Jul-81       PAGE    1-18


  747F    23                            INC     HL              ; ZEICHENAUSWERTUNG
                                
  7480    13                            INC     DE              ; ERSTES SUCHZEICHEN IN RAMT
  7481    1A                            LD      A,(DE)          ; 1. ZEICHEN MUSS '/' SEIN
  7482    FE 2F                         CP      '/'
  7484    28 07                         JR      Z,SU25
  7486    AF                            XOR     A
  7487    32 809B                       LD      (BF10+RTYPE2),A ; '/' fehlt dann TYPE2=0 und TYPE1 SUCHEN
  748A    C3 74B1                       JP      SU62            ; WEITER NACH TYPE1+TYPE2=0 SUCHEN->
                                
  748D    3A 6002               SU25:   LD      A,(RAM+RTYPE1)
  7490    47                            LD      B,A
  7491    3A 6529                       LD      A,(RAMV+RTYPE1)
  7494    B8                            CP      B
  7495    C2 74B1                       JP      NZ,SU62
  7498    3A 652A                       LD      A,(RAMV+RTYPE2)
  749B    FE 01                         CP      1H
  749D    DA 74B1                       JP      C,SU62
  74A0    C2 74B1                       JP      NZ,SU62
  74A3    3A 6B27                       LD      A,(RAMT)        ; neuer Text mit
  74A6    06 3F                         LD      B,03FH          ; laenge (255D) eine Zeile zum vergleichen
  74A8    CD 79EC               SU21:   CALL    SUCH0
  74AB    DA 74B1                       JP      C,SU62
                                        ;CALL   MAS00
  74AE    C3 755D                       JP      SU23
                                
                                        ; Error anzeigen ??
                                        ; Bereich Ende xxxxxxxx1, xxxxxxx2, .... ????
                                        ; noch einbauen
                                        ;
  74B1    CD 7A0E               SU62:   CALL KEYST      ; CONSOLE AUF ZEICHEN ABFRAGE
  74B4    FE 1B                         CP 1BH
  74B6    CA 753B                       JP Z,SU52       ; ABBRUCH MIT ESC
  74B9    ED 5B 6508                    LD DE,(BFVLL)   ; Aktuelle Track/Sectoradresse laden
  74BD    D5                            PUSH DE
  74BE    2A 650A                       LD HL,(BFVHL)
  74C1    E5                            PUSH HL
  74C2    CD 7A1F                       CALL LBA0               ; Suchadresse +1
  74C5    E1                            POP HL
  74C6    22 650A                       LD (BFVHL),HL   
  74C9    D1                            POP DE
  74CA    ED 53 6508                    LD (BFVLL),DE           ; Suchadresse speichern
  74CE    38 6B                         JR C,SU52       ; CARRY -> ENDE
                                ;       LD C,D
                                ;       PUSH BC
                                ;       CALL HEX00
                                ;       POP BC
                                ;       LD C,E
                                ;       PUSH BC
                                ;       CALL HEX00
                                ;       POP BC
  74D0    18 11                         JR SU63
                                        ;--------------
  74D2    ED 4B 8096                    LD BC,(BF07+2)          ; HL
  74D6    ED 42                         SBC HL,BC
  74D8    38 09                         JR C,SU63
        MACRO-80 3.43   27-Jul-81       PAGE    1-19


  74DA    EB                            EX DE,HL
  74DB    ED 4B 8094                    LD BC,(BF07)            ; LL
  74DF    ED 42                         SBC HL,BC               
  74E1    30 58                         JR NC,SU52              ; LETZTE SUCHADRESSE AUS TAS00 
  74E3    7B                    SU63:   LD A,E
  74E4    E6 1F                         AND 1FH
  74E6    FE 10                         CP 10H
  74E8    C2 737C                       JP NZ,SU01
  74EB    CD 788D                       CALL CUT
  74EE    CD 786D                       CALL SANDU
  74F1    C3 737C                       JP SU01
                                        ;--------------------------
                                        ; weiter vergleichen
                                        ; fuer naechste neue Blase vorbereiten 
                                        ; und in neuer Blase uebernehmen
  74F4    2B                    SU90:   DEC     HL              ; ZURUECK ZU TYPE1
  74F5    3A 809A                       LD      A,(BF10+RTYPE1) ; Type1 
  74F8    BE                            CP      (HL)
  74F9    30 09                         JR      NC,SU99
  74FB    3C                            INC     A
  74FC    28 06                         JR      Z,SU99          ; groesser 0FFH
  74FE    BE                            CP      (HL)
  74FF    20 03                         JR      NZ,SU99         ; Abstand groesser 1
  7501    32 809A                       LD      (BF10+RTYPE1),A ; Type1 wenn groesser uebernehmen
  7504    23                    SU99:   INC     HL              ; Type2 in Blase
                                
                                ;--------------------------
                                ;       hier auf erste Type2 =0 selektiert aus Blase
                                
  7505    3A 809B                       LD      A,(BF10+RTYPE2) ; Type2 aus RAMV Blase
  7508    BE                            CP      (HL)
  7509    C2 74B1                       JP      NZ,SU62         ; NEUE RAMV BLASE nicht =0 
                                ;--------------------------
                                ; wenn Gedaechtnisszaehler =0 dann ungueltig
                                ; frei fuer neue Blase
  750C    23                            INC     HL              ; Gedaechtnisz. TERM 
  750D    3A 809C                       LD      A,(BF10+RTERM)  ; Gedaechtnisz. aus Blase
  7510    BE                            CP      (HL)
  7511    CA 74B1                       JP      Z,SU62          ; nicht =1 ->
  7514    23                            INC     HL              ; Status Byte
  7515    23                            INC     HL              ; ZeichenGROESSE
  7516    1A                            LD      A,(DE)          ; neuer Text mit
  7517    47                            LD      B,A
  7518    13                            INC     DE              ; ERSTES ZEICHEN
                                        ;--------------------
                                        ; ERSTES ZEICHEN GROSS
  7519    1A                            LD      A,(DE)
  751A    FE 5B                         CP      5BH
  751C    D2 753B                       JP      NC,SU52         ; ERSTES ZEICHEN MUSS GROSS BUCHST.SEIN
                                        ;--------------------
  751F    78                            LD      A,B
  7520    06 3F                         LD      B,3FH           ; laenge (46D) eine Zeile zum vergleichen
  7522    CD 79EC                       CALL    SUCH0
  7525    DA 74B1                       JP      C,SU62
  7528    3A 6529                       LD      A,(RAMV+RTYPE1) ; WENN BLASE GEFUNDEN TYPE1 UEBERNEHMEN
  752B    32 809A                       LD      (BF10+RTYPE1),A ; Type1 =0 wenn BLASE GEFUNDEN
        MACRO-80 3.43   27-Jul-81       PAGE    1-20


  752E    3A 809B                       LD      A,(BF10+RTYPE2) ; BLASE TYPE1 GEFUNDEN
  7531    3C                            INC     A               ;SET    0,A >0 SETZEN F]R TYPE2 SUCHEN
  7532    32 809B                       LD      (BF10+RTYPE2),A
  7535    C3 755D                       JP      SU23
                                ;-----------------------
                                ; Kein Eintrag in TYPE2>0 gefunden
                                        
  7538    C3 70A9               SU95:   JP      BL00
                                
                                ;----------------
                                ;
  753B    21 82BD               SU52:   LD      HL,MELD01
  753E    06 36                         LD      B,MELD01X
  7540    0E 02                         LD      C,02H           ; BIOS Console Output
  7542    CD 8060                       CALL    BIOS
  7545    11 0000                       LD      DE,0000H
  7548    06 08                         LD      B,08H
  754A    3E 00                         LD A,00H
  754C    32 6B27                       LD (RAMT),A
  754F    15                    SU520:  DEC     D
  7550    20 FD                         JR      NZ,SU520
  7552    1D                            DEC     E
  7553    20 FA                         JR      NZ,SU520
  7555    10 F8                         DJNZ    SU520
  7557    E1                            POP     HL
  7558    D1                            POP     DE
  7559    C1                            POP     BC
  755A    C3 70A9                       JP      BL00
                                        ;----------------
                                        ; AKTUELLE MIT GEFUNDENE BLASE TAUSCHEN
                                        ; DANN NEUE BLASE ANZEIGEN      
  755D    06 04                 SU23:   LD      B,04H
  755F    11 6500                       LD      DE,BFRLL
  7562    21 6508                       LD      HL,BFVLL
  7565    7E                    SU32:   LD      A,(HL)
  7566    12                            LD      (DE),A
  7567    23                            INC     HL
  7568    13                            INC     DE 
  7569    10 FA                         DJNZ    SU32
                                        ; EINGABEZEILE LOESCHEN
  756B    01 2401                       LD BC,2401H
  756E    CD 7ABF                       CALL LIST
  7571    06 46                         LD B,70D
  7573    3E 20                 SU33:   LD A,20H
  7575    CD 78F3                       CALL HEXC
  7578    10 F9                         DJNZ SU33
  757A    E1                            POP HL
  757B    D1                            POP DE
  757C    C1                            POP BC
  757D    C3 706E                       JP BL
                                ;------------------------
                                ;       Starte Eingabemode
                                
  7580    C5                    EING:   PUSH    BC
  7581    D5                            PUSH    DE
  7582    E5                            PUSH    HL
        MACRO-80 3.43   27-Jul-81       PAGE    1-21


                                
                                        ;------------------------
                                        ; pruefe auf Anfangsadresse BLASE = RAM
                                        
  7583    2A 6524                       LD      HL,(RADR)       ; zuletzten Blasenabschnitt Adr.0
  7586    3E 00                         LD      A,00H
  7588    32 6B27                       LD      (RAMT),A        ; ZEICHEN EINGABEZAEHLER AUF 0 SETZEN
  758B    BE                            CP      (HL)
  758C    20 18                         JR      NZ,ED00
  758E    AF                            XOR A
  758F    11 6000                       LD      DE,RAM
  7592    ED 52                         SBC     HL,DE
  7594    20 34                         JR      NZ,ED10         ; -> ADRESSE NICHT GLEICH
                                        ;--------------------
                                        ; (RADR) = RAM und kein Zechen 
                                        ; dann Blase mit 00H ueberschreiben 2*256lang
                                
  7596    06 00                         LD      B,00H
  7598    3E 00                 ED01:   LD      A,00H           ; RAM 256 auf null setzen
  759A    77                            LD      (HL),A
  759B    23                            INC     HL
  759C    10 FA                         DJNZ    ED01
  759E    06 00                         LD      B,00H
  75A0    3E 00                 ED02:   LD      A,00H           ; RAM 256 auf null setzen
  75A2    77                            LD      (HL),A
  75A3    23                            INC     HL
  75A4    10 FA                         DJNZ    ED02
                                        ;---------------------
                                        ; Blasenanfang bestimmen
                                
  75A6    2A 6524               ED00:   LD      HL,(RADR)
                                ;       LD      B,(HL)
  75A9    06 F0                         LD      B,0F0H          ; Max Zeicheneingabe
  75AB    AF                            XOR A
  75AC    11 6000                       LD      DE,RAM
  75AF    ED 52                         SBC     HL,DE
  75B1    2A 6524                       LD      HL,(RADR)
  75B4    20 14                         JR      NZ,ED10         ; -> kein Blasenanfang
  75B6    23                            INC     HL
  75B7    3A 6201                       LD      A,(USER)        ; in Blase uebernemen
  75BA    77                            LD      (HL),A
  75BB    23                            INC     HL
  75BC    3A 6202                       LD      A,(TYPE1)
  75BF    77                            LD      (HL),A
  75C0    23                            INC     HL
  75C1    3A 6203                       LD      A,(TYPE2)
  75C4    77                            LD      (HL),A
  75C5    23                            INC     HL              ; Gedaechtniss Zaehler
  75C6    3E 7F                         LD      A,07FH          ; auf 50% setzen
  75C8    77                            LD      (HL),A
  75C9    23                            INC     HL              ; Status Byte
                                        ;------------------------
                                        ;  Grafik/Text ausgeben
                                
  75CA    3E 30                 ED10:   LD      A,30H
  75CC    32 651C                       LD      (CURT),A
        MACRO-80 3.43   27-Jul-81       PAGE    1-22


  75CF    3E 33                         LD      A,33H
  75D1    32 651D                       LD      (CURT+1),A
  75D4    3E 30                         LD      A,30H
  75D6    32 651E                       LD      (CURT+2),A
  75D9    3E 31                         LD      A,31H
  75DB    32 651F                       LD      (CURT+3),A
                                
  75DE    C5                            PUSH    BC
  75DF    2A 6524                       LD      HL,(RADR)
  75E2    3A 6B27                       LD      A,(RAMT)
  75E5    3C                            INC     A
  75E6    47                            LD      B,A
  75E7    AF                            XOR A           ; RES CARRY FLAG
  75E8    11 6000                       LD      DE,RAM
  75EB    ED 52                         SBC     HL,DE           ; Blasen Anfang pruefen
  75ED    2A 6524                       LD      HL,(RADR)
  75F0    20 0E                         JR      NZ,ED100
  75F2    3E 05                         LD      A,05H
  75F4    85                            ADD     A,L             ; Versatz an Blasenanfang
  75F5    6F                            LD      L,A             ; USER, TYPE1, TYPE2, GE, GS, 
  75F6    3E 30                         LD      A,30H
  75F8    32 651C                       LD      (CURT),A
  75FB    3E 31                         LD      A,31H
  75FD    32 651D                       LD      (CURT+1),A
  7600    CD 788D               ED100:  CALL    CUT
                                
  7603    23                    ED11:   INC     HL              ; erstes Zeichen
  7604    10 03                         DJNZ    ED03
  7606    C1                            POP     BC
  7607    18 0C                         JR      ED12
                                        ;----------------
                                        ; Zeichen ausgeben
                                
  7609    C5                    ED03:   PUSH    BC
  760A    E5                            PUSH    HL
  760B    5E                            LD      E,(HL)
  760C    0E 02                         LD      C,02H
  760E    CD 0005                       CALL    0005H
  7611    E1                            POP     HL
  7612    C1                            POP     BC
  7613    18 EE                         JR      ED11
                                
                                        ;---------------------
                                        ; Tasteneingabe
                                        
  7615    C5                    ED12:   PUSH    BC
  7616    E5                            PUSH    HL
  7617    CD 7A0E               _ED12:  CALL KEYST
  761A    FE 00                         CP 0H
  761C    28 F9                         JR Z,_ED12              ; -> KEIN ZEICHEN
  761E    5F                            LD      E,A             ; neues Zeichen
  761F    E1                            POP     HL
  7620    C1                            POP     BC
  7621    FE 20                         CP      20H
  7623    38 3F                         JR      C,ED30          ; wenn Zeichen < 20H
  7625    FE 23                         CP      23H             ; # Zeichen fuer Eingabenende
        MACRO-80 3.43   27-Jul-81       PAGE    1-23


  7627    CA 765E                       JP      Z,ED20
                                
  762A    CD 76E5                       CALL    ED50
                                
                                        ;-------------------
                                        ; Rechts Parameter anzeichen
                                
  762D    7E                    ED13:   LD      A,(HL)          ; letztes Zeichen zurueckladen
  762E    5F                            LD      E,A             ; und Anzeigen aus Reg. E
  762F    3E 30                         LD      A,30H
  7631    32 651C                       LD      (CURT),A
  7634    3E 35                         LD      A,35H
  7636    32 651D                       LD      (CURT+1),a
  7639    3E 37                         LD      A,37H
  763B    32 651E                       LD      (CURT+2),A
  763E    3E 38                         LD      A,38H
  7640    32 651F                       LD      (CURT+3),A
  7643    C5                            PUSH BC
  7644    4E                            LD C,(HL)
  7645    C5                            PUSH BC
  7646    CD 7850                       CALL HEX14
  7649    C1                            POP BC
  764A    01 0473                       LD BC,0473H
  764D    CD 7ABF                       CALL LIST
  7650    C1                            POP BC
  7651    C5                            PUSH BC
  7652    3A 6B27                       LD A,(RAMT)
  7655    4F                            LD C,A
  7656    C5                            PUSH BC
  7657    CD 7850                       CALL HEX00
  765A    C1                            POP BC
  765B    C1                            POP BC
                                
  765C    10 03                 ED14:   DJNZ    ED15            ; ED12
  765E    C3 76FC               ED20:   JP      EING11
  7661    C3 75CA               ED15:   JP      ED10
                                ;-------------------------
                                ; Steuerzeichen Auswerten
                                
  7664    FE 0D                 ED30:   CP      0DH             ; CR
  7666    28 2B                         JR      Z,ED40
  7668    FE 08                         CP      08H             ; Backspase
  766A    28 32                         JR      Z,ED41
  766C    FE 09                         CP      09H
  766E    28 3D                         JR      Z,ED42          ; TAB
  7670    FE 1B                         CP      1BH             ; ESC
  7672    28 3E                         JR      Z,ED43
  7674    FE 08                         CP      08H             ; ESC
  7676    28 3F                         JR      Z,ED44          ; BackSpace
                                
  7678    C5                            PUSH    BC
  7679    E5                            PUSH    HL
  767A    06 80                         LD      B,80H
  767C    10 FE                 ED31:   DJNZ    ED31
  767E    CD 7A0E                       CALL KEYST      ; CONSOLE AUF ZEICHEN ABFRAGE
  7681    FE 00                         CP 0
        MACRO-80 3.43   27-Jul-81       PAGE    1-24


  7683    28 0A                         JR Z,ED32
  7685    C5                            PUSH BC
  7686    4F                            LD C,A
  7687    C5                            PUSH BC
  7688    CD 7850                       CALL HEX14
  768B    C1                            POP BC
  768C    C1                            POP BC
  768D    18 EB                         JR ED31-2
                                        ;-----------
  768F    E1                    ED32:   POP     HL
  7690    C1                            POP     BC
  7691    18 9A                 ED33:   JR      ED13
                                ;--------------------------
                                
  7693    CD 76E5               ED40:   CALL    ED50
  7696    23                            INC     HL
  7697    3E 0A                         LD      A,0AH
  7699    CD 76E5                       CALL    ED50
                                ;       INC     HL
  769C    18 F3                         JR      ED33
                                
  769E    3E 20                 ED41:   LD      A,20H           ; Zeichen loeschen
  76A0    77                            LD      (HL),A
  76A1    3A 6B27                       LD      A,(RAMT)
  76A4    D6 01                         SUB     01H
  76A6    38 E9                         JR      C,ED33
  76A8    32 6B27                       LD      (RAMT),A
  76AB    18 E4                         JR      ED33
                                
  76AD    CD 76E5               ED42:   CALL    ED50
                                ;       INC     HL
  76B0    18 DF                         JR      ED33
                                
  76B2    CD 76E5               ED43:   CALL    ED50
                                ;       INC     HL
  76B5    18 DA                         JR      ED33
                                
  76B7    E5                    ED44:   PUSH    HL
  76B8    C5                            PUSH    BC
  76B9    3A 6524                       LD      A,(RADR)
  76BC    FE 00                         CP      00H
  76BE    28 21                         JR      Z,ED442
  76C0    3A 6B27                       LD      A,(RAMT)
  76C3    FE 00                         CP      00H
  76C5    28 1A                         JR      Z,ED442
                                
  76C7    01 0002                       LD      BC,0002H
  76CA    7E                    ED441:  LD      A,(HL)
  76CB    2B                            DEC     HL
  76CC    77                            LD      (HL),A
  76CD    23                            INC     HL
  76CE    23                            INC     HL
  76CF    10 F9                         DJNZ    ED441
  76D1    0D                            DEC     C
  76D2    20 F6                         JR      NZ,ED441
  76D4    2A 6524                       LD      HL,(RADR)
        MACRO-80 3.43   27-Jul-81       PAGE    1-25


  76D7    35                            DEC     (HL)
  76D8    2A 6B27                       LD      HL,(RAMT)
  76DB    35                            DEC     (HL)
  76DC    C1                            POP     BC
  76DD    E1                            POP     HL
  76DE    2B                            DEC     HL
  76DF    18 B0                         JR      ED33
                                
  76E1    C1                    ED442:  POP     BC
  76E2    E1                            POP     HL
  76E3    18 AC                         JR      ED33
                                
                                ;--------------------------
                                ; Zeichenzaehler vergleichen
                                ; RAM-Aktuell mit RAM-Text
  76E5    77                    ED50:   LD      (HL),A
  76E6    3A 6B27                       LD      A,(RAMT)
  76E9    3C                            INC     A
  76EA    32 6B27                       LD      (RAMT),A
  76ED    C9                            RET
  76EE    4F                            LD      C,A
  76EF    E5                            PUSH    HL
  76F0    2A 6524                       LD      HL,(RADR)
  76F3    7E                            LD      A,(HL)
  76F4    B9                            CP      C
  76F5    D2 76FA                       JP      NC,ED51         ; RAMT > RADR dann RADR+1
  76F8    3C                            INC     A
  76F9    77                            LD      (HL),A
  76FA    E1                    ED51:   POP     HL
  76FB    C9                            RET
                                
                                        ;-----------------------
                                        ; KEY Stepps Eingabe in HEX
                                 
  76FC    E5                    EING11: PUSH    HL
  76FD    2A 6524                       LD      HL,(RADR)
  7700    3A 6B27                       LD      A,(RAMT)
  7703    77                            LD      (HL),A
                                
  7704    21 82A0                       LD      HL,KEYZ
  7707    06 1D                         LD      B,KEYZX
  7709    0E 02                         LD      C,02H           ; BIOS Console Output
  770B    CD 8060                       CALL    BIOS
                                        ;------------------------
  770E    E1                            POP     HL
  770F    C5                            PUSH BC
  7710    4E                            LD C,(HL)               ; Speicher Lesen 
  7711    C5                            PUSH BC
  7712    CD 7850                       CALL HEX00
  7715    C1                            POP BC
  7716    C1                            POP BC
  7717    E5                            PUSH HL
  7718    CD 7AF8                       CALL    TAS
  771B    5F                            LD      E,A
  771C    CD 77DD                       CALL    HEXI1
  771F    D5                            PUSH    DE
        MACRO-80 3.43   27-Jul-81       PAGE    1-26


  7720    CD 7AF8                       CALL    TAS
  7723    D1                            POP     DE
  7724    5F                            LD      E,A
  7725    CD 77F0                       CALL    HEXI2
  7728    E1                            POP     HL
                                ;       LD      D,10H
  7729    72                            LD      (HL),D
  772A    23                            INC     HL
                                        ;-----------------
                                        ; Dateiaufruf
                                        ; Text ausgeben
                                
  772B    E5                    EING21: PUSH    HL
  772C    21 82F3                       LD      HL,PROZ
  772F    06 25                         LD      B,PROZX
  7731    0E 02                         LD      C,02H           ; BIOS Console Output
  7733    CD 8060                       CALL    BIOS
                                        ;------------------------
  7736    06 0C                         LD      B,0CH           ; Dateinamenlaenge
  7738    0E 00                         LD      C,00H           ; loeschen
  773A    E1                            POP     HL
  773B    C5                    EING22: PUSH    BC
  773C    D5                            PUSH    DE
  773D    5E                            LD      E,(HL)          ; Speicher Lesen 
  773E    E5                            PUSH    HL
  773F    D5                            PUSH    DE
  7740    C5                            PUSH BC
  7741    4B                            LD C,E
  7742    C5                            PUSH BC
  7743    CD 7850                       CALL    HEX00           ; HEX Anzeigen
  7746    C1                            POP BC
  7747    C1                            POP BC
                                ;       LD      C,01H           ; REGISTER FUNKTION (1)
                                ;       CALL    0005h           ; Zeichen lesen 
  7748    CD 7AF8                       CALL    TAS
  774B    D1                            POP     DE
  774C    E1                            POP     HL
  774D    77                            LD      (HL),A          ; Tasteneingabee retten
  774E    D1                            POP     DE
  774F    C1                            POP     BC
  7750    FE 2E                         CP      2EH             ; Dateineman Ende
  7752    20 02                         JR      NZ,EING23       ; -> noch nicht
  7754    06 04                         LD      B,04H           ; Zaehler aus Erweiterung set
  7756    3E 0C                 EING23: LD      A,0CH           ; Dateinamenlaenge
  7758    B8                            CP      B
  7759    20 1A                         JR      NZ,EING25       ; -> kein Anfang mehr
  775B    7E                            LD      A,(HL)          ; Tastein ASCII -> 0-9 unr.
  775C    D6 30                         SUB     30H
  775E    38 2E                         JR      C,EING26
  7760    FE 0A                         CP      0AH
  7762    38 02                         JR      C,EING24
  7764    D6 07                         SUB     07H
  7766    E6 0F                 EING24: AND     0FH
  7768    4F                            LD      C,A
  7769    77                            LD      (HL),A          ; Speichern
  776A    FE 00                         CP      00H
        MACRO-80 3.43   27-Jul-81       PAGE    1-27


  776C    28 20                         JR      Z,EING26        ; Ende -> Ausgang
  776E    E5                            PUSH    HL
  776F    D1                            POP     DE              ; HL -> DE
  7770    13                            INC     DE
  7771    3E FF                         LD      A,0FFH
  7773    12                            LD      (DE),A
  7774    23                            INC     HL
  7775    23                    EING25: INC     HL
  7776    1A                            LD      A,(DE)
  7777    3C                            INC     A
  7778    12                            LD      (DE),A          ; Dateiname Zeichezaehler +1
  7779    10 C0                         DJNZ    EING22
                                ;---
  777B    47                            LD      B,A             ; naechste Dateiadresse berechnen
  777C    3E 0C                         LD      A,0CH
  777E    90                            SUB     B
  777F    16 00                         LD      D,00H
  7781    5F                            LD      E,A
  7782    19                            ADD     HL,DE
  7783    E5                            PUSH    HL
  7784    D1                            POP     DE
  7785    3E 00                         LD      A,00H
  7787    12                            LD      (DE),A
  7788    23                            INC     HL
                                ;--
  7789    06 0B                         LD      B,0BH
  778B    0D                            DEC     C
  778C    20 AD                         JR      NZ,EING22
                                        ;-------------
                                
  778E    06 0F                 EING26: LD      B,0FH
  7790    AF                    EING27: XOR     A
  7791    77                            LD      (HL),A
  7792    23                            INC     HL
  7793    10 FB                         DJNZ    EING27
  7795    C3 70A9                       JP BL00         ; PUSH POP ???
  7798    E1                    EING30: POP     HL
  7799    D1                            POP     DE
  779A    C1                            POP     BC
  779B    C3 70A9                       JP      BL00
                                
                                ;-------------------------
                                ; TYPE2 MASKE AUFBAUEN
                                
  779E    3A 6000               MAS00:  LD      A,(RAM)
  77A1    47                            LD      B,A             ; ZEICHENL$NGE ZUM ANHAENGEN
                                        ; CURSOR AUF XXXXZEILE 1 SETZEN
  77A2    3E 30                         LD      A,30H
  77A4    32 651C                       LD      (CURT),A
  77A7    3E 31                         LD      A,31H
  77A9    32 651D                       LD      (CURT+1),A
                                        ;------------------
                                        ; CURSOR RECHTR SCHIEBEN
                                
  77AC    3E 00                         LD      A,0H
  77AE    3C                    MAS01:  INC     A
        MACRO-80 3.43   27-Jul-81       PAGE    1-28


  77AF    27                            DAA
  77B0    10 FC                         DJNZ    MAS01
  77B2    47                            LD      B,A
  77B3    E6 0F                         AND     0FH
  77B5    C6 30                         ADD     A,30H
  77B7    32 651F                       LD      (CURT+3),A
  77BA    78                            LD      A,B
  77BB    0F                            RRCA
  77BC    0F                            RRCA
  77BD    0F                            RRCA
  77BE    0F                            RRCA
  77BF    E6 0F                         AND     0FH
  77C1    C6 30                         ADD     A,30H
  77C3    32 651E                       LD      (CURT+2),A
  77C6    CD 788D                       CALL    CUT
                                
  77C9    11 6B27                       LD      DE,RAMT
  77CC    1A                            LD      A,(DE)
  77CD    47                            LD      B,A
  77CE    13                    MAS02:  INC     DE
  77CF    1A                            LD      A,(DE)
  77D0    CD 78F3                       CALL    HEXC
  77D3    10 F9                         DJNZ    MAS02
  77D5    C9                            RET     
  77D6    C3 753B                       JP      SU52
                                ;-------------------------
                                ; Programmaufruf mit Cursor up/down
                                
  77D9    00                    ZEI00:  NOP
  77DA    C3 7271                       JP      BL132
                                
                                ;-------------------------
                                ;   Hexunwandlung
                                
  77DD    7B                    HEXI1:  LD      A,E             ; Eingabe Umwandeln
  77DE    D6 30                         SUB     30H
  77E0    38 1D                         JR      C,HEXIE
  77E2    FE 0A                         CP      0AH
  77E4    38 02                         JR      C,HEX11
  77E6    D6 07                         SUB     07H
  77E8    07                    HEX11:  RLCA
  77E9    07                            RLCA
  77EA    07                            RLCA
  77EB    07                            RLCA
  77EC    E6 F0                         AND     0F0H
  77EE    57                            LD      D,A
  77EF    C9                            RET
                                
  77F0    7B                    HEXI2:  LD      A,E             ; Adresse anzeigen
  77F1    D6 30                         SUB     30H
  77F3    38 0A                         JR      C,HEXIE
  77F5    FE 0A                         CP      0AH
  77F7    38 02                         JR      C,HEX12
  77F9    D6 07                         SUB     07H
  77FB    E6 0F                 HEX12:  AND     0FH
                                        ;ADD    A,D     ; ??
        MACRO-80 3.43   27-Jul-81       PAGE    1-29


                                        ;LD     D,A     ; ??
  77FD    5F                            LD      E,A
  77FE    C9                            RET
  77FF    06 01                 HEXIE:  LD      B,01H
  7801    C9                            RET
                                ;-------------------------
                                ;  HEX Ausgabe mit Position
                                
  7802    3A 651C               HEXP:   LD      A,(CURT)
  7805    F5                            PUSH    AF
  7806    3A 651D                       LD      A,(CURT+1)
  7809    F5                            PUSH    AF
  780A    3A 651E                       LD      A,(CURT+2)
  780D    F5                            PUSH    AF
  780E    3A 651F                       LD      A,(CURT+3)
  7811    F5                            PUSH    AF
  7812    3E 30                         LD      A,30H
  7814    32 651C                       LD      (CURT),A
  7817    3E 31                         LD      A,31H
  7819    32 651D                       LD      (CURT+1),A
  781C    3E 35                         LD      A,35H
  781E    32 651E                       LD      (CURT+2),A
  7821    3E 30                         LD      A,30H
  7823    32 651F                       LD      (CURT+3),A
  7826    CD 788D                       CALL    CUT
  7829    C5                            PUSH BC
  782A    4B                            LD C,E
  782B    C5                            PUSH BC
  782C    CD 7850                       CALL    HEX00
  782F    C1                            POP BC
  7830    C1                            POP BC
  7831    F1                            POP     AF
  7832    32 651F                       LD      (CURT+3),A
  7835    F1                            POP     AF
  7836    32 651E                       LD      (CURT+2),A
  7839    F1                            POP     AF
  783A    32 651D                       LD      (CURT+1),A
  783D    F1                            POP     AF
  783E    32 651C                       LD      (CURT),A
  7841    CD 788D                       CALL    CUT
  7844    C9                            RET
                                
                                ;-------------------------
                                ;  Hex ausgeben
  7845    3E 0A                 HEXA:   LD      A,0AH
  7847    CD 78F3                       CALL    HEXC
  784A    3E 0D                         LD      A,0DH
  784C    CD 78F3                       CALL    HEXC
  784F    C9                            RET
                                ;------------------
  7850                          HEX00:  
  7850    DD E5                 HEX14:  PUSH IX
  7852    DD 21 0000                    LD IX,0
  7856    DD 39                         ADD IX,SP
                                ;---------
  7858    DD 4E 04                      LD C,(IX+4)             ; Adresse anzeigen
        MACRO-80 3.43   27-Jul-81       PAGE    1-30


  785B    C5                            PUSH BC
  785C    CD 7F06                       CALL ASCII_CODE
  785F    C1                            POP BC
  7860    78                            LD A,B
  7861    CD 78F3                       CALL HEXC
  7864    79                            LD A,C          ; ADRESSE ANZEIGEN
  7865    CD 78F3                       CALL HEXC
                                ;-----------
  7868    DD F9                         LD SP,IX
  786A    DD E1                         POP IX
  786C    C9                            RET
                                ;------------------------
                                ; Warte schlange
                                
  786D    C5                    SANDU:  PUSH    BC
  786E    D5                            PUSH    DE
  786F    E5                            PUSH    HL
  7870    3A 6520                       LD      A,(SANDB)
  7873    FE 2F                         CP      2FH     
  7875    38 06                         JR      C,SA1
  7877    28 08                         JR      Z,SA2
  7879    3E 2D                         LD      A,2DH
  787B    18 06                         JR      SA3
  787D    3E 2F                 SA1:    LD      A,2FH
  787F    18 02                         JR      SA3
  7881    3E 5C                 SA2:    LD      A,5CH
  7883    32 6520               SA3:    LD      (SANDB),A
  7886    CD 78F3                       CALL    HEXC
  7889    E1                            POP     HL
  788A    D1                            POP     DE
  788B    C1                            POP     BC
  788C    C9                            RET
                                
                                ;------------------------
                                ; Cursor auf Position setzen
                                
  788D    C5                    CUT:    PUSH    BC
  788E    D5                            PUSH    DE
  788F    E5                            PUSH    HL
  7890    3E 1B                         LD      A,1BH
  7892    CD 78F3                       CALL    HEXC
  7895    3E 5B                         LD      A,5BH
  7897    CD 78F3                       CALL    HEXC
  789A    3A 651C                       LD      A,(CURT)
  789D    CD 78F3                       CALL    HEXC
  78A0    3A 651D                       LD      A,(CURT+1)
  78A3    CD 78F3                       CALL    HEXC
  78A6    3E 3B                         LD      A,3BH
  78A8    CD 78F3                       CALL    HEXC
  78AB    3A 651E                       LD      A,(CURT+2)
  78AE    CD 78F3                       CALL    HEXC
  78B1    3A 651F                       LD      A,(CURT+3)
  78B4    CD 78F3                       CALL    HEXC
  78B7    3E 48                         LD      A,48H
  78B9    CD 78F3                       CALL    HEXC
  78BC    E1                            POP     HL
        MACRO-80 3.43   27-Jul-81       PAGE    1-31


  78BD    D1                            POP     DE
  78BE    C1                            POP     BC
  78BF    C9                            RET
                                
                                ;------------------------
                                ; Cursor auf Position setzen
                                
  78C0    C5                    CU0:    PUSH    BC
  78C1    D5                            PUSH    DE
  78C2    E5                            PUSH    HL
  78C3    3E 1B                         LD      A,1BH
  78C5    CD 78F3                       CALL    HEXC
  78C8    3E 5B                         LD      A,5BH
  78CA    CD 78F3                       CALL    HEXC
  78CD    3A 6518                       LD      A,(CURS)
  78D0    CD 78F3                       CALL    HEXC
  78D3    3A 6519                       LD      A,(CURS+1)
  78D6    CD 78F3                       CALL    HEXC
  78D9    3E 3B                         LD      A,3BH
  78DB    CD 78F3                       CALL    HEXC
  78DE    3A 651A                       LD      A,(CURS+2)
  78E1    CD 78F3                       CALL    HEXC
  78E4    3A 651B                       LD      A,(CURS+3)
  78E7    CD 78F3                       CALL    HEXC
  78EA    3E 48                         LD      A,48H
  78EC    CD 78F3                       CALL    HEXC
  78EF    E1                            POP     HL
  78F0    D1                            POP     DE
  78F1    C1                            POP     BC
  78F2    C9                            RET
                                
                                ;------------------------
                                ;  Zeichen Ausgeben
                                
  78F3    C5                    HEXC:   PUSH BC
  78F4    D5                            PUSH DE
  78F5    E5                            PUSH HL
  78F6    5F                            LD E,A
  78F7    F5                            PUSH AF
  78F8    0E 02                         LD C,02H
  78FA    CD 0005                       CALL 0005H
  78FD    F1                            POP AF
  78FE    E1                            POP HL
  78FF    D1                            POP DE
  7900    C1                            POP BC
  7901    C9                            RET
                                        ;--------------
                                        ; Cursor on
  7902    E5                    CON:    PUSH HL
  7903    C5                            PUSH BC
  7904    21 80B4                       LD HL,CURON             ; CURSOR ON
  7907    06 06                         LD B,06H
  7909    7E                    CUR02:  LD A,(HL)
  790A    CD 78F3                       CALL HEXC
  790D    23                            INC HL
  790E    10 F9                         DJNZ CUR02
        MACRO-80 3.43   27-Jul-81       PAGE    1-32


  7910    C1                            POP BC
  7911    E1                            POP HL
  7912    C9                            RET
                                        ;--------------
                                        ; Cursor off
  7913    E5                    COFF:   PUSH HL
  7914    C5                            PUSH BC
  7915    21 80BA                       LD HL,CUROFF            ; CURSOR OFF
  7918    06 06                         LD B,06D
  791A    7E                    CUR01:  LD A,(HL)
  791B    CD 78F3                       CALL HEXC
  791E    23                            INC HL
  791F    10 F9                         DJNZ CUR01
  7921    C1                            POP BC
  7922    E1                            POP HL
  7923    C9                            RET
                                
                                ;-----------------------
                                ;  DRIVE ZUGRIFF VORBEREITEN
  7924    DB FF                 WAITRDY:IN A,(IDESTAT)
  7926    CB 77                         BIT 6,A
  7928    28 FA                         JR Z,WAITRDY
  792A    CB 7F                         BIT 7,A
  792C    20 F6                         JR NZ,WAITRDY
  792E    C9                            RET
                                        ;----------
  792F                          WAITDRQ: 
  792F    DB FF                         IN A,(IDESTAT)
  7931    CB 5F                         BIT 3,A
  7933    28 FA                         JR Z,WAITDRQ
  7935    CB 7F                         BIT 7,A
  7937    20 F6                         JR NZ,WAITDRQ
  7939    C9                            RET
                                        ;----------
  793A                          HDD_WAIT:
                                        ;LD B,0
                                        ;DJNZ $
  793A    DB FF                 _WAIT1: IN A,(IDESTAT)
  793C    E6 80                         AND 80H
  793E    20 FA                         JR NZ,_WAIT1
  7940    C9                            RET
                                        ;-------------
  7941                          HDD_INIT:
  7941    3E 02                         LD A,02H
  7943    D3 FF                         OUT (IDECMD),A
  7945    CD 793A                       CALL HDD_WAIT
                                ;-----
  7948    3E F0                         LD A,0F0H
  794A    D3 FE                         OUT (IDESDH),A
  794C    3E 01                         LD A,01H
  794E    D3 FA                         OUT (IDESCNT),A
  7950    3E EF                         LD A,0EFH
  7952    D3 FF                         OUT (IDECMD),A
  7954    CD 793A                       CALL HDD_WAIT
  7957    CD 795B                       CALL HDD_ERROR
  795A    C9                            RET
        MACRO-80 3.43   27-Jul-81       PAGE    1-33


                                ;---------
  795B                          HDD_ERROR:
  795B    DB FF                         IN A,(IDESTAT)
  795D    4F                            LD C,A
  795E    C5                            PUSH BC
  795F    CD 7850                       CALL HEX00
  7962    C1                            POP BC
  7963    79                            LD A,C
  7964    E6 01                         AND 01H
  7966    C8                            RET Z
  7967    21 8318                       LD HL,DERR
  796A    06 26                         LD B,L_DERR
  796C    7E                    ERR1:   LD A,(HL)
  796D    CD 78F3                       CALL HEXC
  7970    23                            INC HL
  7971    10 F9                         DJNZ ERR1
  7973    C9                            RET
                                ;--------------
  7974                          HDD_INFO:
  7974    CD 793A                       CALL HDD_WAIT
  7977    3E EC                         LD A,0ECH
  7979    D3 FF                         OUT (IDECMD),A
  797B    21 1964                       LD HL,6500
  797E    CD 7982                       CALL HDD_READ
  7981    C9                            RET
                                ;-----------
  7982                          HDD_READ:
  7982    CD 793A                       CALL HDD_WAIT
  7985    DB FF                         IN A,(IDESTAT)
  7987    E6 08                         AND 08H
  7989    C8                            RET Z
  798A    DB F8                         IN A,(IDEDAT)
  798C    77                            LD (HL),A
                                ;       CALL HEXC;!!! TESTAUSGABEN
  798D    23                            INC HL
  798E    18 F2                         JR HDD_READ
                                ;-------------
                                ; IDE-FESTPLATTE RESET
  7990                          IDERES:
  7990    CD 7996                       CALL IDERES1
  7993    C3 793A                       JP HDD_WAIT
                                        ;----------
  7996    CD 8017               IDERES1:CALL EXTERN
  7999    F5                            PUSH AF         ; PIOA
  799A    C5                            PUSH BC
  799B    3E 06                         LD A,06H
  799D    D3 F6                         OUT (IDEDOR),A
  799F    06 00                         LD B,0
  79A1    10 FE                         DJNZ $
  79A3    3E 02                         LD A,02H
  79A5    D3 F6                         OUT (IDEDOR),A
  79A7    C1                            POP BC
  79A8    F1                            POP AF
  79A9    D3 1C                         OUT (PIOA),A
  79AB    C9                            RET 
                                ;-------------
        MACRO-80 3.43   27-Jul-81       PAGE    1-34


  79AC    DD E5                 DISK:   PUSH IX
  79AE    DD 21 0000                    LD IX,0
  79B2    DD 39                         ADD IX,SP
                                ;--------
  79B4    DD 7E 05                      LD A,(IX+5)     ; D= HEAD SELECT, LBA HIGH MIT HIGH=B
  79B7    E6 0F                         AND 0FH         ; HEAD SELECT
  79B9    47                            LD B,A
  79BA    3E F7                         LD A,SELDS      ; IN INCLUDE
  79BC    E6 F0                         AND 0F0H
  79BE    B0                            OR B
  79BF    CB FF                         SET 7,A
  79C1    DD 77 05                      LD (IX+5),A
  79C4    D3 FE                         OUT (IDESDH),A
  79C6    DD 7E 04                      LD A,(IX+4)     ; TRACK HIGH
  79C9    D3 FD                         OUT (IDECHI),A
  79CB    DD 7E 07                      LD A,(IX+7)     ; TRACK LOW
  79CE    D3 FC                         OUT (IDECLO),A
  79D0    DD 7E 06                      LD A,(IX+6)     ; C= SECTOR
  79D3    D3 FB                         OUT (IDESNUM),A
  79D5    3E 01                         LD A,01H
  79D7    D3 FA                         OUT (IDESCNT),A
                                        ;----------
  79D9    DD F9                         LD SP,IX
  79DB    DD E1                         POP IX
  79DD    C9                            RET
                                ;--------------------
  79DE    F5                    FREI:   PUSH    AF      
  79DF    C5                            PUSH    BC
  79E0    D5                            PUSH    DE
  79E1    E5                            PUSH    HL
  79E2    0E 0B                         LD C,0BH        ; KONSOLE EINGABE (TASTE GEDRUECKT?)
  79E4    CD 0005                       CALL 0005H
  79E7    E1                            POP     HL
  79E8    D1                            POP     DE
  79E9    C1                            POP     BC
  79EA    F1                            POP     AF
  79EB    C9                            RET
                                
                                ;-----------------------
                                ; ZEICHEN SUCHEN IM RAM AUS EINGABE RAMT
                                 
  79EC    08                    SUCH0:  EX      AF,AF'          ; Textlaenge retten
  79ED    1A                            LD      A,(DE)          ; neuer Text mit
  79EE    BE                            CP      (HL)            ; Blaseninhalt 
  79EF    28 0B                         JR      Z,SUCH2
  79F1    23                            INC     HL
  79F2    3A 6B27                       LD      A,(RAMT)
  79F5    11 6B28                       LD      DE,RAMT+1
  79F8    10 F2                         DJNZ    SUCH0
  79FA    37                    SUCH1:  SCF
  79FB    C9                            RET
                                
  79FC    13                    SUCH2:  INC     DE
  79FD    23                            INC     HL
  79FE    3E 2A                         LD      A,2AH
  7A00    CD 78F3                       CALL    HEXC
        MACRO-80 3.43   27-Jul-81       PAGE    1-35


  7A03    08                            EX      AF,AF'
  7A04    3D                            DEC     A
  7A05    20 E5                         JR      NZ,SUCH0
  7A07    7E                            LD      A,(HL)          ; Text Ende <30H
  7A08    FE 2F                         CP      2FH             ; ENDE < 21H = !
  7A0A    30 EE                         JR      NC,SUCH1        ; -> kein Ende
  7A0C    AF                            XOR     A
  7A0D    C9                            RET     
                                ;-----------------------
                                ; CONSOLE QUERY AND PICK 
                                ; WITHOUT WAITING
                                ; 
  7A0E    C5                    KEYST:  PUSH BC
  7A0F    0E 0B                         LD C,0BH        ; GET CONSILE STATUS
  7A11    CD 0005                       CALL 0005H
  7A14    FE 00                         CP 0
  7A16    28 05                         JR Z,KEY01
  7A18    0E 01                         LD C,01H        ; console Input read chr
  7A1A    CD 0005                       CALL 0005H
  7A1D    C1                    KEY01:  POP BC
  7A1E    C9                            RET 
                                ;-----------------------
                                ; LBA Z[HLER HERH\HE BID HDDE ENDE
                                
  7A1F    DD E5                 LBA0:   PUSH IX
  7A21    DD 21 0000                    LD IX,0
  7A25    DD 39                         ADD IX,SP
                                ;--------
  7A27    DD 4E 06                      LD C,(IX+6)     ; LBA LOW SECTOR
  7A2A    DD 46 07                      LD B,(IX+7)
  7A2D    0C                            INC C
  7A2E    DD 71 06                      LD (IX+6),C
  7A31    20 35                         JR NZ,LBA20
  7A33    04                            INC B
  7A34    DD 70 07                      LD (IX+7),B
  7A37    20 2F                         JR NZ,LBA20
  7A39    DD 4E 04                      LD C,(IX+4)     ; LBA TRACK 
  7A3C    DD 46 05                      LD B,(IX+5)
  7A3F    03                            INC BC
  7A40    DD 71 04                      LD (IX+4),C     ; LBA TRACK
  7A43    DD 70 05                      LD (IX+5),B
  7A46    AF                            XOR A           ; RES CARRY FLAG
  7A47    21 00BE                       LD HL,HDDE      ; DISK ENDE
  7A4A    ED 42                         SBC HL,BC       ; -C
  7A4C    30 1A                         JR NC,LBA20     
  7A4E    01 0801                       LD BC,HDD+1
  7A51    DD 71 06                      LD (IX+6),C
  7A54    DD 70 07                      LD (IX+7),B
  7A57    01 0000                       LD BC,0
  7A5A    DD 71 04                      LD (IX+4),C
  7A5D    DD 70 05                      LD (IX+5),B
  7A60    C3 0000                       JP 0;!!!!
  7A63    18 03                         JR LBA20
                                        ; ENDE ERREICHT
  7A65    37                    LBA4:   SCF             ;AUSGANG FEHLER
  7A66    18 01                         JR LBA21
        MACRO-80 3.43   27-Jul-81       PAGE    1-36


                                ;-----------
  7A68    AF                    LBA20:  XOR A           ; SET CARRY -> OHNE FEHLER
  7A69    DD F9                 LBA21:  LD SP,IX
  7A6B    DD E1                         POP IX
  7A6D    C9                            RET
                                ;-----------------
                                ; ADRESSE -1
  7A6E    C3 0000               LBA5:   JP 0;!!!
  7A71    DD E5                 PUSH IX
  7A73    DD 21 0000                    LD IX,0
  7A77    DD 39                         ADD IX,SP
                                ;------
  7A79    DD 46 07                      LD B,(IX+7)     ; LBA 
  7A7C    DD 4E 06                      LD C,(IX+6)     ; LOW
  7A7F    0B                            DEC BC
  7A80    78                            LD A,B
  7A81    E6 F0                         AND 0F0H
  7A83    28 23                         JR Z,L__6
  7A85    06 0F                         LD B,0FH
  7A87    DD 70 07                      LD (IX+7),B     ; LBA 
  7A8A    DD 71 06                      LD (IX+6),C     ; LOW
  7A8D    DD 46 05                      LD B,(IX+5)     ; LBA HIGH
  7A90    DD 4E 04                      LD C,(IX+4)     ; LOW
  7A93    0B                            DEC BC
  7A94    E5                            PUSH HL
  7A95    AF                            XOR A
  7A96    21 0800                       LD HL,HDD
  7A99    ED 42                         SBC HL,BC
  7A9B    E1                            POP HL
  7A9C    38 02                         JR C,L__7
  7A9E    18 C5                         JR LBA4
                                        ;-----------
  7AA0    DD 70 05              L__7:   LD (IX+5),B
  7AA3    DD 71 04                      LD (IX+4),C
  7AA6    18 C0                         JR LBA20
                                        ;_-------
  7AA8    DD 70 07              L__6:   LD (IX+7),B     ; LBA HIGH
  7AAB    DD 71 06                      LD (IX+6),C     ; LOW
  7AAE    18 B8                         JR LBA20
                                
  7AB0    DD 46 05                      LD B,(IX+5)     ; LBA HIGH
  7AB3    DD 4E 04                      LD C,(IX+4)     ; LOW
  7AB6    0B                            DEC BC
  7AB7    DD 70 05                      LD (IX+5),B
  7ABA    DD 71 04                      LD (IX+4),C
  7ABD    18 A9                         JR LBA20
                                        ; --------------------
                                        ; aktuelle Blasenadresse
                                
  7ABF    78                    LIST:   LD A,B
  7AC0    E6 F0                         AND 0F0H
  7AC2    0F                            RRCA
  7AC3    0F                            RRCA
  7AC4    0F                            RRCA
  7AC5    0F                            RRCA
  7AC6    C6 30                         ADD A,30H
        MACRO-80 3.43   27-Jul-81       PAGE    1-37


  7AC8    32 651C                       LD (CURT),A
  7ACB    78                            LD A,B
  7ACC    E6 0F                         AND 0FH
  7ACE    C6 30                         ADD A,30H
  7AD0    32 651D                       LD (CURT+1),a
  7AD3    79                            LD A,C
  7AD4    E6 F0                         AND 0F0H
  7AD6    0F                            RRCA
  7AD7    0F                            RRCA
  7AD8    0F                            RRCA
  7AD9    0F                            RRCA
  7ADA    C6 30                         ADD A,30H
  7ADC    32 651E                       LD (CURT+2),A
  7ADF    79                            LD A,C
  7AE0    E6 0F                         AND 0FH
  7AE2    C6 30                         ADD A,30H
  7AE4    32 651F                       LD (CURT+3),A
  7AE7    CD 788D                       CALL CUT
  7AEA    C9                            RET
                                        ;-------------
                                        ; ZUM TEST (HL)+1  30MAL AUSGEBEN
                                        ;
  7AEB    06 1E                 LIS0:   LD B,30D
  7AED    7E                    LIS1:   LD A,(HL)
  7AEE    4F                            LD C,A
  7AEF    C5                            PUSH BC
  7AF0    CD 7850                       CALL HEX00
  7AF3    C1                            POP BC
  7AF4    23                            INC HL
  7AF5    10 F6                         DJNZ LIS1
  7AF7    C9                            RET
                                ;---------------------------
                                ;  Kontrollausgabe rechts
                                ;
  7AF8    CD 7913               TAS:    CALL COFF
  7AFB    ED 73 651C                    LD (CURT),SP
  7AFF    C5                            PUSH BC
  7B00    06 00                         LD B,00H
  7B02    10 FE                         DJNZ $
  7B04    01 2273                       LD BC,2273H
  7B07    CD 7ABF                       CALL LIST       ;CURSOR POS
  7B0A    C1                            POP BC
  7B0B    3A 650F                       LD A,(BFSHH)
  7B0E    4F                            LD C,A
  7B0F    C5                            PUSH BC
  7B10    CD 7850                       CALL HEX00              ; ADRESSE DER AKTUEL GELESENEN BLASE
  7B13    C1                            POP BC
  7B14    3A 650E                       LD A,(BFSHL)
  7B17    4F                            LD C,A
  7B18    C5                            PUSH BC
  7B19    CD 7850                       CALL HEX00
  7B1C    C1                            POP BC
  7B1D    3A 650D                       LD A,(BFSLH)
  7B20    4F                            LD C,A
  7B21    C5                            PUSH BC
  7B22    CD 7850                       CALL HEX00
        MACRO-80 3.43   27-Jul-81       PAGE    1-38


  7B25    C1                            POP BC
  7B26    3A 650C                       LD A,(BFSLL)
  7B29    4F                            LD C,A
  7B2A    C5                            PUSH BC
  7B2B    CD 7850                       CALL HEX00
  7B2E    C1                            POP BC
                                        ; --------------------
                                        ; aktuelle Blasenadresse
  7B2F    C5                            PUSH BC
  7B30    01 2173                       LD BC,2173H
  7B33    CD 7ABF                       CALL LIST       ;CURSOR POS
  7B36    C1                            POP BC
  7B37    3A 8097                       LD A,(BF07+3) ;(BFRHH)
  7B3A    4F                            LD C,A
  7B3B    C5                            PUSH BC
  7B3C    CD 7850                       CALL HEX00
  7B3F    C1                            POP BC
  7B40    3A 8096                       LD A,(BF07+2)  ;(BFRHL)
  7B43    4F                            LD C,A
  7B44    C5                            PUSH BC
  7B45    CD 7850                       CALL HEX00
  7B48    C1                            POP BC
  7B49    3A 8095                       LD A,(BF07+1)  ;(BFRLH)
  7B4C    4F                            LD C,A
  7B4D    C5                            PUSH BC
  7B4E    CD 7850                       CALL HEX00
  7B51    C1                            POP BC
  7B52    3A 8094                       LD A,(BF07) ;(BFRLL)
  7B55    4F                            LD C,A
  7B56    C5                            PUSH BC
  7B57    CD 7850                       CALL HEX00
  7B5A    C1                            POP BC
                                        ;---------------------
                                        ; CURSOR IN EINGABEZEILE MIT EINGABE SCHIEBEN
  7B5B    3E 32                 TAS00:  LD A,32H
  7B5D    32 651C                       LD (CURT),A
  7B60    3E 34                         LD A,34H
  7B62    32 651D                       LD (CURT+1),A
  7B65    3E 31                         LD A,31H
  7B67    32 651E                       LD (CURT+2),A
  7B6A    3A 6B27                       LD A,(RAMT)
  7B6D    C6 30                         ADD A,30H
  7B6F    FE 3A                         CP 3AH
  7B71    38 0E                         JR C,RD07
  7B73    D6 0A                         SUB 0AH
  7B75    32 651F                       LD (CURT+3),A
  7B78    3A 651E                       LD A,(CURT+2)
  7B7B    3C                            INC A
  7B7C    32 651E                       LD (CURT+2),A
  7B7F    18 03                         JR RD08
  7B81                          RD07:   ;LD A,35H
  7B81    32 651F                       LD (CURT+3),A
  7B84    CD 788D               RD08:   CALL CUT
  7B87    06 14                         LD B,20D
  7B89    21 6728                       LD HL,RAMS+RUSER
  7B8C    CD 788D               RD09:   CALL CUT
        MACRO-80 3.43   27-Jul-81       PAGE    1-39


  7B8F    CD 7902                       CALL CON
                                ;-----------------------
                                ; Tastenabfrage und Zeichen einlesen
                                ; Sonst weitere Task ausfueren
                                ;
                                ; LBA ZAEHLER +1
                                ;
  7B92    ED 5B 650C                    LD DE,(BFSLL)   ; Aktuelle Track/Sectoradresse laden
  7B96    ED 53 6C43                    LD (COP+4),DE   ; STARTPUNKT NACH SPEICHERN
  7B9A    D5                            PUSH DE
  7B9B    2A 650E                       LD HL,(BFSHL)
  7B9E    22 6C45                       LD (COP+6),HL
  7BA1    E5                            PUSH HL
  7BA2    CD 7A1F                       CALL LBA0       ; LBA + 1
  7BA5    E1                            POP HL
  7BA6    22 650E                       LD (BFSHL),HL   ; adresse HIGH speichern
  7BA9    D1                            POP DE
  7BAA    ED 53 650C                    LD (BFSLL),DE   ; adresse LOW speichern
  7BAE    DA 0000                       JP C,0 ;NOCH ENDE BEI FEHLER RD91               ; RUECKGABE CARRY 0=FEHLER
                                        ;---------------- 
                                        ; 1. BLASE + 1 = 2.BLASE
  7BB1    D5                            PUSH DE         ; IX UEBERGABE
  7BB2    E5                            PUSH HL         ; IX UEBERGEBE
  7BB3    CD 7A1F                       CALL LBA0       ; LBA + 1
  7BB6    E1                            POP HL
  7BB7    22 6512                       LD (BFSHL+4),HL ; adresse HIGH speichern
  7BBA    D1                            POP DE
  7BBB    ED 53 6510                    LD (BFSLL+4),DE ; adresse LOW speichern
  7BBF    DA 0000                       JP C,0 ;NOCH ENDE BEI FEHLER RD91               ; RUECKGABE CARRY 0=FEHLER
  7BC2    CD 79DE                       CALL FREI       ; TAST INT FREI
                                        ;---------------------
                                        ; Erste Blase laden
  7BC5    ED 4B 650C                    LD BC,(BFSLL)
  7BC9    ED 5B 650E                    LD DE,(BFSHL)
  7BCD    21 6727                       LD HL,RAMS
  7BD0    CD 7DE4                       CALL RDREAD     ; BFSLL BLASE LADEN
  7BD3    CD 79DE                       CALL FREI
                                        ; READ SICHTBAR MACHEN
                                        ;LD BC,1001H
                                        ;CALL LIST
                                        ;LD HL,RAMS
                                        ;CALL LIS0
                                        ;------
  7BD6    3A 672D                       LD A,(RAMS+RSOTR)
  7BD9    FE 1B                         CP 1BH
  7BDB    28 0E                         JR Z,TAS03
  7BDD    21 833E                       LD HL,NBLASE
  7BE0    11 6727                       LD DE,RAMS
  7BE3    01 00A3                       LD BC,NBLLE
  7BE6    ED B0                         LDIR
                                        ; READ SICHTBAR MACHEN
                                        ;LD BC,1101H
                                        ;CALL LIST
                                        ;LD HL,RAMS
                                        ;CALL LIS0
  7BE8    C3 7CC1                       JP RD170
        MACRO-80 3.43   27-Jul-81       PAGE    1-40


                                        ;-------------------
                                        ; Zweite Blase laden
  7BEB    ED 4B 6510            TAS03:  LD BC,(BFSLL+4)
  7BEF    ED 5B 6512                    LD DE,(BFSHL+4)
  7BF3    21 6927                       LD HL,RAMS+200H
  7BF6    CD 7DE4                       CALL RDREAD     ; BFSLL BLASE LADEN
  7BF9    CD 79DE                       CALL FREI
                                        ;------
                                        ; READ SICHTBAR MACHEN
                                        ;LD BC,1101H
                                        ;CALL LIST
                                        ;LD HL,RAMS+200H
                                        ;CALL LIS0
                                ;------------------------------
                                ; Blasen der groesse nach Sortieren
                                ; USER, AUSFSTEIGEND
                                ; wenn U > U+1 dann tauschen
                                ; wenn U < U+1 dann Gedaechtniss -1
                                ; wsen der groesse nach Sortieren
                                ; USER, AUSFSTEIGEND
                                ; wenn U > U+1 dann tauschen
                                ; wenn U < U+1 dann Gedaechtniss -1
                                ; wenn U = U+1 dann weiter
                                ;
  7BFC    21 6928                       LD      HL,RAMS+RUSER+200H      ;BLASE2 RAM
  7BFF    11 6728                       LD      DE,RAMS+RUSER           ;BLASE1 RAM
  7C02    1A                            LD      A,(DE)          ; USER vergleich
  7C03    BE                            CP      (HL)            ; Blase2 > Blase1 dann
  7C04    DA 7C73                       JP      C,RD06          ; zum naechstem >USER 2  neu anfangen
  7C07    C2 7CD7                       JP      NZ,RD01         ; Blase2 < Blase1 tauschen ->
                                ;----------------------
                                ; Blasen der groesse nach Sortieren
                                ; TYPE1, AUFSTEIGEND
                                ; wenn T1 > T1+1 (DE)-(HL) =NC,dann tauschen
                                ; wenn T1 = T1+1 (DE)-(HL) =Z,dann TYPE2 
                                ; wenn T1 < T1+1 (DE)-(HL) =NZ,dann GEDAECHTNIS
                                ;
  7C0A    21 6929                       LD      HL,RAMS+RTYPE1+200H     ; Blase2
  7C0D    11 6729                       LD      DE,RAMS+RTYPE1          ; Blase1
  7C10    1A                            LD      A,(DE)                  ; TYPE1 Vergleich
  7C11    BE                            CP      (HL)                    ; Blase2 > Blase1 dann
  7C12    DA 7C73                       JP      C,RD06                  ; zum Gedaechtnis zuruecksetzen 
  7C15    C2 7CD7                       JP      NZ,RD01                 ; tauschen und Speichern 
                                ;       JP RD02 ;!!!!!TEST
                                ;----------------------
                                ; Blasen der groesse nach Sortieren
                                ; TYPE2 AUFSTEIGEND
                                ; wenn T2 > T2+1 (DE)-(HL) =NC,dann tauschen
                                ; wenn T2 = T2+1 (DE)-(HL) = Z,dann gedaechtniss-1
                                ; wenn T2 < T2+1 (DE)-(HL) =NZ,dann weiter
                                ;
  7C18    21 692A               RD25:   LD HL,RAMS+RTYPE2+200H  ; Blase2
  7C1B    11 672A                       LD DE,RAMS+RTYPE2       ; Blase1
  7C1E    1A                            LD A,(DE)
  7C1F    FE 01                         CP 01H                  ; RAM+TYPE2 > 0
  7C21    20 09                         JR NZ,RD255             ; TYPE2 BEREITS 1=FORNE JA ->
        MACRO-80 3.43   27-Jul-81       PAGE    1-41


  7C23    BE                            CP (HL)
                                ;??     CALL C,TASK     ; NOCH AUSARBEITEN
  7C24    3A 692C                       LD A,(RAMS+RBSTAT+200H)
  7C27    E6 07                         AND 07H
  7C29    CA 7CD7                       JP Z,RD01               ; BLASE 2 SPEICHERN MIT TAUSCHEN
  7C2C    1A                    RD255:  LD A,(DE)
  7C2D    BE                            CP (HL)                 ; Blase2 > Blase1 dann
  7C2E    38 06                         JR C,RD26
  7C30    CA 7C56                       JP Z,RD36               ; ZUM GEDAECHTNIS
  7C33    D2 7CD7                       JP NC,RD01              ; TAUSCHEN
                                        ;----------------------
  7C36    1A                    RD26:   LD A,(DE)               ; BLASE1 TYPE2 Vergleich
  7C37    FE 00                         CP 0H
  7C39    C2 7C73                       JP NZ,RD06              ; zum Gedaechtnisszaehler
                                        ;----------------------
                                        ; GED[CHTNISS BLASE1 TYPE2=0 MIT BLASE2 TYPE2>0 VERGLEICHEN
                                         
  7C3C    21 672B                       LD HL,RAMS+RTERM                ; Blase1
  7C3F    11 692B                       LD DE,RAMS+RTERM+200H   ; Blase2
  7C42    1A                            LD A,(DE)                       ; Gedaechtnissz Vergleich
  7C43    BE                            CP (HL)
  7C44    38 2D                         JR C,RD06                       ; 1>2 GEDAECHTNISS FALLEND
  7C46    3C                            INC A
  7C47    20 01                         JR NZ,RD250
  7C49    1A                            LD A,(DE)
  7C4A    77                    RD250:  LD (HL),A
  7C4B    ED 4B 650C                    LD BC,(BFSLL)
  7C4F    ED 5B 650E                    LD DE,(BFSHL)           ; Suchadresse 2. BLASE speichern
  7C53    C3 7D44                       JP RD03
                                        ;----------------------
                                        ; Blasen der groesse nach Sortieren
                                        ; GEDAECHTNIS FALLEND
  7C56    7E                    RD36:   LD A,(HL)
  7C57    FE 00                         CP 0
  7C59    20 0D                         JR NZ,RD35
  7C5B    3A 672C                       LD A,(RAMS+RBSTAT)
  7C5E    E6 78                         AND 78H
  7C60    F6 47                         OR 47H
  7C62    32 672C                       LD (RAMS+RBSTAT),A
  7C65    C3 7C36                       JP RD26 
                                        ;---------------------
  7C68    21 692B               RD35:   LD HL,RAMS+RTERM+200H   ; Blase2
  7C6B    11 672B                       LD DE,RAMS+RTERM                ; Blase1
  7C6E    1A                            LD A,(DE)               ; Gedaechtnissz Vergleich
  7C6F    BE                            CP (HL)
  7C70    DA 7CD7                       JP C,RD01               ; tauschen und Speichern fallend
                                        ;---------------------
                                        ; Gedaechtniss zuruecksetzen wenn Tag ungleich ist
                                
  7C73    CD 79DE               RD06:   CALL    FREI
  7C76    3A 80A2                       LD      A,(DAYT)        ; TAG AUS UHR
  7C79    E6 07                         AND     07H
  7C7B    47                            LD      B,A
  7C7C    3A 672C                       LD      A,(RAMS+RBSTAT) ; TAG AUS BLASE1
  7C7F    E6 07                         AND     07H
  7C81    B8                            CP      B
        MACRO-80 3.43   27-Jul-81       PAGE    1-42


  7C82    C2 7C8F                       JP      NZ,RDD1         ; NICHT GLEICH ->
  7C85    3A 672C                       LD      A,(RAMS+RBSTAT) ; TAG AUS BLASE1
  7C88    CB 77                         BIT     6,A             ; PRUEFE SORTIEREN 
  7C8A    20 03                         JR      NZ,RDD1         ; SPEICHERN ->
  7C8C    C3 7D93                       JP      RD02            ; GLEICH nicht speichern gleicher Tag
                                        ;------------------
                                        ; NEUER TAG UND GEDAECHTNIS SPEICHERN
  7C8F    3A 672C               RDD1:   LD A,(RAMS+RBSTAT)      ; BLASE 1
  7C92    E6 F8                         AND 0F8H
  7C94    B0                            OR B            ; neuer Tag einbinden 
  7C95    CB B7                         RES 6,A         ; Zaehler aktivieren
  7C97    CB 7F                         BIT 7,A         ; Blase benutzt fuer +/-
  7C99    28 11                         JR Z,RD16       ; Gedaechtniss abziehen =0
  7C9B    CB BF                         RES 7,A         ; =1 ADDIEREN loesche
  7C9D    32 672C                       LD (RAMS+RBSTAT),A      ; wieder zurueck in Blase1
  7CA0    3A 672B                       LD A,(RAMS+RTERM)       ; GEDAECHTNISSZAEHLER AUS RAM
  7CA3    3C                            INC A                   ; Gedaechtniss +1
  7CA4    CA 7CC1                       JP Z,RD170              ; Ausgang WENN MAX ERREICHT
  7CA7    32 672B                       LD (RAMS+RTERM),A       ; ZURUECK IN RAM
  7CAA    18 0D                         JR RD17
                                        ;--------------
  7CAC    32 672C               RD16:   LD (RAMS+RBSTAT),A      ; TAG SPEICHERN
  7CAF    3A 672B                       LD A,(RAMS+RTERM)
  7CB2    D6 01                         SUB 01H                 ; Gedaechtniss schon Min
  7CB4    38 16                         JR C,RD171              ; Ausgang WENN MIN ERREICHT
  7CB6    32 672B                       LD (RAMS+RTERM),A       ; ZURUECK IN RAM
  7CB9    3A 6205               RD17:   LD A,(BSTAT)
  7CBC    CB B7                         RES 6,A                 ; Sortieren aktivieren aller Blasen
  7CBE    32 6205                       LD (BSTAT),A
  7CC1    ED 5B 650E            RD170:  LD DE,(BFSHL)           ; Suchadresse speichern
  7CC5    ED 4B 650C                    LD BC,(BFSLL)
  7CC9    C3 7D44                       JP RD03                 ; nur Blase1 ohne tauschen speicher
                                        ;------------------
  7CCC    3A 6728               RD171:  LD A,(RAMS+RUSER)
  7CCF    3C                            INC A
  7CD0    28 EF                         JR Z,RD170
  7CD2    32 6728                       LD (RAMS+RUSER),A       ; User =FFH damit Blase wieder an Schluss wandert
  7CD5    18 EA                         JR RD170
                                
                                        ;-----------------------
                                        ; Zweite Blase mit Erster Blase beim Speichern tauschen
  7CD7    ED 4B 650C            RD01:   LD BC,(BFSLL)
  7CDB    ED 5B 650E                    LD DE,(BFSHL)   ; Suchadresse 1.Blase speichern
  7CDF    21 6927                       LD HL,RAMS+200H         ; MIT WERT AUS 2.BLASE SPEICHERN
  7CE2    CD 7E0D                       CALL RDWRITE
                                        ;------
                                        ; WRITE SICHTBAR MACHEN
                                        ;LD BC,1401H
                                        ;CALL LIST
                                        ;LD HL,RAMS+200H
                                        ;CALL LIS0
                                        ;--------
  7CE5    3A 6205                       LD A,(BSTAT)
  7CE8    CB B7                         RES 6,A         ; SORTIEREN START
  7CEA    32 6205                       LD (BSTAT),A
                                        ;-------------------
        MACRO-80 3.43   27-Jul-81       PAGE    1-43


                                        ; pruefe ob AKTUELLE ZAEHLER ALS 1. Blase offen ist
  7CED    AF                            XOR A           ; RES CARRY FLAG
  7CEE    ED 5B 650E                    LD DE,(BFSHL)   ; ADRESSE HIGH
  7CF2    2A 6502                       LD HL,(BFRHL)   ; AKTUELL SICHTBARE BLASE
  7CF5    ED 52                         SBC HL,DE       ;-C
  7CF7    20 1D                         JR NZ,TAS22     ; BLASE H SORTIEREN UND OFFEN NICHT GLEICH ->
  7CF9    AF                            XOR A           ; RES CARRY FAG
  7CFA    ED 5B 650C                    LD DE,(BFSLL)   ; ADRESSE LOW
  7CFE    2A 6500                       LD HL,(BFRLL)
  7D01    ED 52                         SBC HL,DE       ;-C
  7D03    20 11                         JR NZ,TAS22
                                        ;-------------------
                                        ; DANN ADRESSE AKTUELLER BLASE AUCH TAUSCHEN
                                        ; SICHTBARE BLASE VERSCHIEBEN
  7D05    ED 5B 6510                    LD DE,(BFSLL+4)
  7D09    2A 6512                       LD HL,(BFSHL+4)
  7D0C    22 6502                       LD (BFRHL),HL
  7D0F    ED 53 6500                    LD (BFRLL),DE
  7D13    C3 7D3C                       JP TAS24
                                        ;-------------------
                                        ; pruefe ob AKTUELLE ZAEHLER ALS 1. Blase offen ist
  7D16    AF                    TAS22:  XOR A           ; RES CARRY FLAG
  7D17    ED 5B 6512                    LD DE,(BFSHL+4) ; Aktuelle Track/Sectoradresse laden
  7D1B    2A 6502                       LD HL,(BFRHL)
  7D1E    ED 52                         SBC HL,DE       ; -C
  7D20    20 1A                         JR NZ,TAS24     ; BLASE H SORTIEREN UND OFFEN NICHT GLEICH ->
  7D22    AF                            XOR A           ; RES CARRY FLAG
  7D23    ED 5B 6510                    LD DE,(BFSLL+4) ; Aktuelle Track/Sectoradresse laden
  7D27    2A 6500                       LD HL,(BFRLL)
  7D2A    ED 52                         SBC HL,DE       ; -C
  7D2C    20 0E                         JR NZ,TAS24
                                        ;-----------------
                                        ; AKTUELLE BLASE TAUSCHEN H->L
  7D2E    ED 5B 650C                    LD DE,(BFSLL)
  7D32    2A 650E                       LD HL,(BFSHL)
  7D35    ED 53 6500                    LD (BFRLL),DE
  7D39    22 6502                       LD (BFRHL),HL
                                        ;-----------------------
                                        ; Erste Blase mit zweiter Blase beim Speichern tauschen
  7D3C    ED 4B 6510            TAS24:  LD BC,(BFSLL+4)
  7D40    ED 5B 6512                    LD DE,(BFSHL+4) ; Suchadresse 2. BLASE speichern
  7D44    21 6727               RD03:   LD HL,RAMS
  7D47    CD 7E0D                       CALL RDWRITE
                                        ;------
                                        ; WRITE SICHTBAR MACHEN
                                        ;LD BC,1601H
                                        ;CALL LIST
                                        ;LD HL,RAMS+200H
                                        ;CALL LIS0
                                        ;--------
  7D4A    3A 6205                       LD A,(BSTAT)
  7D4D    CB 77                         BIT 6,A
  7D4F    20 42                         JR NZ,RD02
  7D51    CB F7                         SET 6,A         ; STOP/START
  7D53    32 6205                       LD (BSTAT),A
                                        ;----------------------
        MACRO-80 3.43   27-Jul-81       PAGE    1-44


                                        ; nach letztem Blase speichern Sortieradresse > letzter Blase Adr. 
                                        ; dann neu Adr. speichern und bei HDD-neu Anfangsadr. beginnen
  7D56    AF                            XOR A           ; RES CARRY FLAG
  7D57    2A 8096                       LD HL,(BF07+2)
  7D5A    ED 5B 650E                    LD DE,(BFSHL)   ; LETZTE Suchadresse speichern
  7D5E    ED 52                         SBC HL,DE       ; -C
  7D60    30 17                         JR NC,RD30
  7D62    ED 53 8096                    LD (BF07+2),DE  ; SPEICHE WENN HL<DE
  7D66    ED 4B 650C                    LD BC,(BFSLL)
  7D6A    ED 43 8094                    LD (BF07),BC
  7D6E    ED 5B 650C                    LD DE,(BFSLL)
  7D72    ED 4B 650E                    LD BC,(BFSHL)
  7D76    C3 7DAA                       JP RD90 
                                        ;---------------
  7D79    ED 5B 650C            RD30:   LD DE,(BFSLL)
  7D7D    ED 4B 650E                    LD BC,(BFSHL)
  7D81    C2 7DD7                       JP NZ,RD92
  7D84    AF                            XOR A           ; RES CARRY FLAG
  7D85    2A 8094                       LD HL,(BF07)
  7D88    ED 52                         SBC HL,DE       ; -C
  7D8A    30 07                         JR NC,RD02
  7D8C    ED 53 8094                    LD (BF07),DE
  7D90    C3 7DAA                       JP RD90         ; NACH sPEICHERN BLASE VON NULL NEUSTART
                                ;-----------
  7D93                          RD02:   ;------
                                        ; READ SICHTBAR MACHEN
                                        ;LD BC,0501H
                                        ;CALL LIST
                                        ;LD HL,RAMS
                                        ;CALL LIS0
  7D93    CD 79DE                       CALL FREI
  7D96    ED 5B 650E                    LD DE,(BFSHL)           ; LETZTE SUCHADRESSE SPEICHERN
                                        ; LD (BF07+4),DE
  7D9A    ED 4B 650C                    LD BC,(BFSLL)
                                        ; LD (BF07+6),BC
                                        ;ACHTUNG SECTOR 8/16 LD (BF07),BC
  7D9E    CD 7EAC                       CALL UHR00
                                        ;---------------------
                                        ; Tastenabfrage und Zeichen einlesen
  7DA1    CD 7A0E                       CALL KEYST
  7DA4    FE 00                         CP 0H
  7DA6    CA 7AF8                       JP Z,TAS        ;TAS00
  7DA9    C9                            RET                     ; RETURN ZU BL ENDE
                                
                                ;---------------------
                                ; RD90 AUSGABE UEBERSPRINGEN
                                ; SUCHADRESSE
                                ;
  7DAA    E5                    RD90:   PUSH HL
  7DAB    D5                            PUSH DE
  7DAC    C5                            PUSH BC
  7DAD    ED 5B 650C                    LD DE,(BFSLL)
  7DB1    ED 4B 650E                    LD BC,(BFSHL)
  7DB5    CB 38                         SRL B
  7DB7    CB 19                         RR C
  7DB9    CB 1A                         RR D
        MACRO-80 3.43   27-Jul-81       PAGE    1-45


  7DBB    CB 1B                         RR E
  7DBD    AF                            XOR A           ; RES CARRY FLAG
  7DBE    21 0000                       LD HL,0000H
  7DC1    ED 42                         SBC HL,BC       ; -C HIGH
  7DC3    20 12                         JR NZ,RD92      ; BC >0 ->
  7DC5    21 0800                       LD HL,HDD
  7DC8    ED 52                         SBC HL,DE
  7DCA    30 05                         JR NC,RD911
  7DCC    18 09                         JR RD92
                                ;----------------------
                                ; RESET TO HDD START
                                ; 
  7DCE    E5                    RD91:   PUSH HL
  7DCF    D5                            PUSH DE
  7DD0    C5                            PUSH BC
  7DD1    11 0801               RD911:  LD DE,HDD+1
  7DD4    01 0000                       LD BC,0
  7DD7    ED 53 650C            RD92:   LD (BFSLL),DE
  7DDB    ED 43 650E                    LD (BFSHL),BC
  7DDF    C1                            POP BC
  7DE0    D1                            POP DE
  7DE1    E1                            POP HL
  7DE2    18 AF                         JR RD02
                                ;------------------------
                                ; READ SECTOR VON HDD
                                ;
  7DE4    DD E5                 RDREAD: PUSH IX
  7DE6    DD 21 0000                    LD IX,0
  7DEA    DD 39                         ADD IX,SP
                                        ;----------------
  7DEC    CD 8017                       CALL EXTERN
  7DEF    F5                            PUSH AF         ; PIOA RESCUE
                                        ;----------------
  7DF0    E5                            PUSH HL         ; DMA
  7DF1    C5                            PUSH BC         ; DISK SEL
  7DF2    D5                            PUSH DE         ; DISK SEL
  7DF3    CD 79AC                       CALL DISK
  7DF6    D1                            POP DE
  7DF7    3E 20                         LD A,CMD_READSEC
  7DF9    D3 FF                         OUT (IDECMD),A
  7DFB    7A                            LD A,D
  7DFC    D3 FE                         OUT (IDESDH),A
  7DFE    CD 792F                       CALL WAITDRQ
  7E01    C1                            POP BC
  7E02    E1                            POP HL
  7E03    06 00                         LD B,00H
  7E05    0E F8                         LD C,IDEDAT
  7E07    ED B2                         INIR
  7E09    ED B2                         INIR
  7E0B    18 24                         JR HDIST
                                ;----------------------
                                ; BLASE TO SAVE DE=HIGH, BC=LOW
                                ;
  7E0D                          RDWRITE:
  7E0D    DD E5                         PUSH IX
  7E0F    DD 21 0000                    LD IX,0
        MACRO-80 3.43   27-Jul-81       PAGE    1-46


  7E13    DD 39                         ADD IX,SP
                                        ;----------------
  7E15    CD 8017                       CALL EXTERN
  7E18    F5                            PUSH AF         ; PIOA RESCUE
                                        ;----------------
  7E19    E5                            PUSH HL         ; DMA
  7E1A    C5                            PUSH BC         ; DISK SEL
  7E1B    D5                            PUSH DE         ; DISK SEL
  7E1C    CD 79AC                       CALL DISK
  7E1F    D1                            POP DE
  7E20    C1                            POP BC
  7E21    3E 30                         LD A,CMD_WRITESEC
  7E23    D3 FF                         OUT (IDECMD),A
  7E25    CD 792F                       CALL WAITDRQ
  7E28    E1                            POP HL          ; DMA ZURUECK
  7E29    06 00                         LD B,00H
  7E2B    0E F8                         LD C,IDEDAT
  7E2D    ED B3                         OTIR
  7E2F    ED B3                         OTIR
                                        ;----------------
  7E31    F1                    HDIST:  POP AF
  7E32    D3 1C                         OUT (PIOA),A    ; PIOA BACK UP
  7E34    DD F9                         LD SP,IX
  7E36    DD E1                         POP IX
  7E38    C9                            RET
                                ;---------------------
                                ; TASK zum Programm Starten
                                ; auf Adr. 100H
                                
  7E39                          TASK:   ;PUSH   AF
  7E39    C5                            PUSH    BC
  7E3A    D5                            PUSH    DE
  7E3B    E5                            PUSH    HL
  7E3C    3A 6928                       LD      A,(RAMS+RUSER+200H)
  7E3F    FE FF                         CP      0FFH
  7E41    30 41                         JR      NC,TASK99       ; USER = FFH nicht auswerten
  7E43    7E                            LD      A,(HL)          ; TYPE2 Blase2 vergleichen
  7E44    FE 02                         CP      02H
  7E46    38 3C                         JR      C,TASK99
  7E48    3A 6003                       LD      A,(RAM+RTYPE2)
  7E4B    FE 02                         CP      02H
  7E4D    30 35                         JR      NC,TASK99       ; WENN IN RAM >1 EXTERNE TASK EINGABE
                                        ;----------------------
                                        ; EXTERN BEARBEITEN
                                
  7E4F    11 0080                       LD      DE,BUFF
  7E52    21 824C                       LD      HL,PRLO1
  7E55    7E                            LD      A,(HL)
  7E56    12                            LD      (DE),A
  7E57    13                            INC     DE
  7E58    47                            LD      B,A
  7E59    CD 7289                       CALL    BL13
                                ;ERROR ??
                                ; CALL  E.TEXT
                                ; JR    NC,TASK99
                                
        MACRO-80 3.43   27-Jul-81       PAGE    1-47


  7E5C    CD 0100                       CALL    0100H
  7E5F    FE 00                         CP      0
  7E61    20 21                         JR      NZ,TASK99
  7E63    ED 4B 6510                    LD BC,(BFSLL+4)
  7E67    C5                            PUSH BC
  7E68    ED 5B 6512                    LD DE,(BFSHL+4) ; Suchadresse 2. BLASE speichern
  7E6C    D5                            PUSH DE
  7E6D    CD 79AC                       CALL DISK
  7E70    D1                            POP DE
  7E71    C1                            POP BC
  7E72    38 10                         JR      C,TASK99
  7E74    01 6927                       LD      BC,RAMS+200H            ; MIT WERT AUS 1. BLASE
  7E77    CD F82F                       CALL    SETDMA
  7E7A    CD 8017                       CALL EXTERN
  7E7D    F5                            PUSH AF
  7E7E    CD F817                       CALL WRITE
  7E81    F1                            POP AF
  7E82    D3 1C                         OUT (PIOA),A
                                
                                        ;----------------
  7E84    E1                    TASK99: POP     HL
  7E85    D1                            POP     DE
  7E86    C1                            POP     BC
                                        ;POP    AF
  7E87    C9                            RET
                                        ;-----------------------
                                        ; Blase Speichern  aus RAMS in 
                                        ; BC = LL- LH , DE = HL-HH Adresse LBA
  7E88    C5                    TWRITE: PUSH BC
  7E89    D5                            PUSH DE
  7E8A    CD 79AC                       CALL DISK
  7E8D    D1                            POP DE
  7E8E    C1                            POP BC
  7E8F    D8                            RET C
  7E90    01 6727                       LD BC,RAMS              ; MIT WERT AUS 2. BLASE
  7E93    CD F82F                       CALL SETDMA
  7E96    CD 8017                       CALL EXTERN
  7E99    F5                            PUSH AF
  7E9A    CD F817                       CALL WRITE
  7E9D    F1                            POP AF
  7E9E    D3 1C                         OUT (PIOA),A
  7EA0    AF                            XOR     A
  7EA1    C9                            RET
                                ;---------------
                                ; INTERRUPT FUER TASK PRUEFEN
                                ;INT:   EI
  7EA2    00                            NOP
  7EA3    00                            NOP
  7EA4    00                            NOP
  7EA5    00                            NOP
  7EA6    00                            NOP
  7EA7    00                            NOP
  7EA8    00                            NOP
  7EA9    00                            NOP
  7EAA    F3                            DI
  7EAB    C9                            RET
        MACRO-80 3.43   27-Jul-81       PAGE    1-48


                                
                                ;-----------------------
                                ;  Uhr auslesen
                                
  7EAC    C5                    UHR00:  PUSH BC
  7EAD    CD 8010                       CALL INTERN
  7EB0    F5                            PUSH AF
  7EB1    DB 1E                         IN A,(PIOB)
  7EB3    F5                            PUSH AF
  7EB4    3E 3F                         LD A,3FH                ; Adresse fuer Uhr
  7EB6    D3 1E                         OUT (PIOB),A
                                        ;-----------------
                                        ; Minuten in Dezimal
                                        ;
  7EB8    3E 40                         LD A,040H               ; Lesen Ein
  7EBA    D3 98                         OUT (URCS+18H),A
  7EBC    DB 9A                         IN A,(URCS+1AH) ; Minuten
  7EBE    4F                            LD C,A
                                ;       XOR A
                                ;       OUT (URCS+18H),A        ; R/W Aus
  7EBF    C5                            PUSH BC
  7EC0    CD 7F06                       CALL ASCII_CODE
  7EC3    C1                            POP BC
  7EC4    78                            LD A,B
  7EC5    32 80A5                       LD (DAYZ+2),A           ; ZEHNER
  7EC8    3A 80A6                       LD A,(DAYZ+3)
  7ECB    B9                            CP C
  7ECC    28 2B                         JR Z,UHR01              ; ZEITAENERUNG NEIN ->
  7ECE    79                            LD A,C
  7ECF    32 80A6                       LD (DAYZ+3),A
                                        ;-----------------------
                                        ;       Stunde
                                        ;
                                ;       LD A,040H               ; Lesen Ein
                                ;       OUT (URCS+18H),A
  7ED2    00                            NOP
  7ED3    DB 9B                         IN A,(URCS+1BH) ; Stunde
  7ED5    4F                            LD C,A
  7ED6    AF                            XOR A
  7ED7    D3 98                         OUT (URCS+18H),A        ; R/W Aus
  7ED9    C5                            PUSH BC
  7EDA    CD 7F06                       CALL ASCII_CODE
  7EDD    C1                            POP BC
  7EDE    78                            LD A,B
  7EDF    32 80A3                       LD (DAYZ),A
  7EE2    79                            LD A,C
  7EE3    32 80A4                       LD (DAYZ+1),A
                                        ;-----------------
                                        ; DAY auslesen
                                        ;
                                ;       LD A,040H               ; Lesen Ein
                                ;       OUT (URCS+18H),A
  7EE6    00                            NOP
  7EE7    DB 9D                         IN A,(URCS+1DH) ; Tag
  7EE9    47                            LD B,A
                                ;       XOR A
        MACRO-80 3.43   27-Jul-81       PAGE    1-49


                                ;       OUT (URCS+18H),A        ; Lesen Aus
  7EEA    78                            LD A,B
  7EEB    32 80A2                       LD (DAYT),A
                                        ;-----------------
                                        ; Monat auslesen
                                        ;
                                ;       LD A,040H               ; Lesen Ein
                                ;       OUT (URCS+18H),A
  7EEE    00                            NOP
  7EEF    DB 9E                         IN A,(URCS+1EH) ; Tag
  7EF1    47                            LD B,A
                                ;       XOR A
                                ;       OUT (URCS+18H),A        ; Lesen Aus
  7EF2    78                            LD A,B
  7EF3    32 80A1                       LD (DAYM),A
                                        ;------------------
                                        ; Zeit ausgeben
                                        ;
  7EF6    CD 7F37                       CALL    UHR10
  7EF9    AF                    UHR01:  XOR A
  7EFA    D3 98                         OUT (URCS+18H),A        ; Lesen Aus
  7EFC    F1                            POP AF
  7EFD    E6 F0                         AND 0F0H
  7EFF    D3 1E                         OUT (PIOB),A
  7F01    F1                            POP AF
  7F02    D3 1C                         OUT (PIOA),A
  7F04    C1                            POP BC
  7F05    C9                            RET
                                ;---------
  7F06                          ASCII_CODE:
  7F06    DD E5                         PUSH IX
  7F08    DD 21 0000                    LD IX,0
  7F0C    DD 39                         ADD IX,SP
                                        ;------
  7F0E    DD 7E 04                      LD A,(IX+4)     ;B=HIGH
  7F11    0F                            RRCA
  7F12    0F                            RRCA
  7F13    0F                            RRCA
  7F14    0F                            RRCA
  7F15    E6 0F                         AND 0FH
  7F17    C6 30                         ADD A,30H
  7F19    FE 3A                         CP 3AH
  7F1B    38 02                         JR C,ASC_1
  7F1D    C6 07                         ADD A,07H
  7F1F    DD 77 05              ASC_1:  LD (IX+5),A
  7F22    DD 7E 04                      LD A,(IX+4)     ; C=LOW
  7F25    E6 0F                         AND 0FH
  7F27    C6 30                         ADD A,30H
  7F29    FE 3A                         CP 3AH
  7F2B    38 02                         JR C,ASC_2
  7F2D    C6 07                         ADD A,07H
  7F2F    DD 77 04              ASC_2:  LD (IX+4),A
                                        ;---------
  7F32    DD F9                         LD SP,IX
  7F34    DD E1                         POP IX
  7F36    C9                            RET             ; RETURN =BC
        MACRO-80 3.43   27-Jul-81       PAGE    1-50


                                ;-----------------------
                                ;   Uhr anzeigen
                                ;
  7F37    CD 7913               UHR10:  CALL COFF       ; CURSOR AUS
  7F3A    3E 1B                         LD      A,1BH
  7F3C    CD 78F3                       CALL    HEXC
  7F3F    3E 5B                         LD      A,5BH
  7F41    CD 78F3                       CALL    HEXC
  7F44    3E 3F                         LD      A,3FH
  7F46    CD 78F3                       CALL    HEXC
  7F49    3E 32                         LD      A,32H
  7F4B    CD 78F3                       CALL    HEXC
  7F4E    3E 35                         LD      A,35H
  7F50    CD 78F3                       CALL    HEXC
  7F53    3E 6C                         LD      A,6CH
  7F55    CD 78F3                       CALL    HEXC
                                        ;
                                        ;---------------
                                        ; Zeile/Spalte
  7F58    C5                            PUSH BC
  7F59    01 0075                       LD BC,0075H
  7F5C    CD 7ABF                       CALL LIST       ; CURSOR POS
  7F5F    C1                            POP BC
  7F60    3A 80A3                       LD A,(DAYZ)
  7F63    CD 78F3                       CALL HEXC
  7F66    3A 80A4                       LD A,(DAYZ+1)
  7F69    CD 78F3                       CALL HEXC
  7F6C    3E 3A                         LD A,3AH
  7F6E    CD 78F3                       CALL HEXC
  7F71    3A 80A5                       LD A,(DAYZ+2)
  7F74    CD 78F3                       CALL HEXC
  7F77    3A 80A6                       LD A,(DAYZ+3)
  7F7A    CD 78F3                       CALL HEXC
                                        ;-----------
  7F7D    3E 1B                         LD A,1BH
  7F7F    CD 78F3                       CALL HEXC
  7F82    3E 5B                         LD A,5BH
  7F84    CD 78F3                       CALL HEXC
  7F87    3E 3F                         LD A,3FH
  7F89    CD 78F3                       CALL HEXC
  7F8C    3E 32                         LD A,32H
  7F8E    CD 78F3                       CALL HEXC
  7F91    3E 35                         LD A,35H
  7F93    CD 78F3                       CALL HEXC
  7F96    3E 6C                         LD A,6CH
  7F98    CD 78F3                       CALL HEXC
  7F9B    C5                            PUSH BC
  7F9C    01 2475                       LD BC,2475H
  7F9F    CD 7ABF                       CALL LIST       ;CURSOR POS
  7FA2    C1                            POP BC
  7FA3    3A 80A2                       LD A,(DAYT)
  7FA6    4F                            LD C,A
  7FA7    C5                            PUSH BC
  7FA8    CD 7F06                       CALL ASCII_CODE
  7FAB    C1                            POP BC
  7FAC    78                            LD A,B
        MACRO-80 3.43   27-Jul-81       PAGE    1-51


  7FAD    CD 78F3                       CALL HEXC
  7FB0    79                            LD A,C
  7FB1    CD 78F3                       CALL HEXC
  7FB4    3E 2E                         LD A,2EH
  7FB6    CD 78F3                       CALL HEXC
  7FB9    3A 80A1                       LD A,(DAYM)
  7FBC    4F                            LD C,A
  7FBD    C5                            PUSH BC
  7FBE    CD 7F06                       CALL ASCII_CODE
  7FC1    C1                            POP BC
  7FC2    78                            LD A,B
  7FC3    CD 78F3                       CALL HEXC
  7FC6    79                            LD A,C
  7FC7    CD 78F3                       CALL HEXC
                                ;-----------------------
  7FCA    3E 32                         LD      A,32H
  7FCC    32 651C                       LD      (CURT),A
  7FCF    3E 34                         LD      A,34H
  7FD1    32 651D                       LD      (CURT+1),A
  7FD4    3A 6B27                       LD      A,(RAMT)
  7FD7    CB 7F                         BIT     7,A
  7FD9    28 04                         JR      Z,RDU03
  7FDB    3E 30                         LD      A,30H
  7FDD    18 02                         JR      RDU03+2
  7FDF    3E 31                 RDU03:  LD      A,31H
  7FE1    32 651E                       LD      (CURT+2),A
  7FE4    3A 6B27                       LD      A,(RAMT)
  7FE7    E6 0F                         AND     0FH
  7FE9    C6 30                         ADD     A,30H
  7FEB    FE 3A                         CP      3AH
  7FED    38 0E                         JR      C,RDU01
  7FEF    D6 0A                         SUB     0AH
  7FF1    32 651F                       LD      (CURT+3),A
  7FF4    3A 651E                       LD      A,(CURT+2)
  7FF7    3C                            INC     A
  7FF8    32 651E                       LD      (CURT+2),A
  7FFB    18 03                         JR      RDU02
  7FFD    32 651F               RDU01:  LD      (CURT+3),A
                                
  8000    CD 788D               RDU02:  CALL    CUT
  8003    21 80B4                       LD HL,CURON             ; CURSOR ON
  8006    06 06                         LD B,06D
  8008    7E                    CUR03:  LD A,(HL)
  8009    CD 78F3                       CALL HEXC
  800C    23                            INC HL
  800D    10 F9                         DJNZ CUR03
  800F    C9                            RET
                                ;------------------
                                ;
                                ;INCLUDE LCDINI.MAC
                                ;------------------
                                        ;
                                        ; BUS INTERN UMSCHALTUNG
                                        ;
  8010    DB 1C                 INTERN: IN A,(PIOA)
  8012    F5                            PUSH AF
        MACRO-80 3.43   27-Jul-81       PAGE    1-52


  8013    CB BF                         RES 7,A
  8015    18 05                         JR TERN
                                        ; EXTERN
  8017    DB 1C                 EXTERN: IN A,(PIOA)
  8019    F5                            PUSH AF
  801A    CB FF                         SET 7,A
  801C    D3 1C                 TERN:   OUT (PIOA),A
  801E    F1                            POP AF
  801F    C9                            RET
                                ;----------------
  8020                          EPROMON:        
  8020    DB 1C                         IN A,(PIOA)
  8022    CB B7                         RES 6,A
  8024    D3 1C                         OUT (PIOA),A    ; EPROM Ein
  8026    C3 0000                       JP 0000H        ; EPROM NEUSTART -> PROGRAMM ENDE
                                ;------------------------
  8029    42 4C 41 53           TEX1:   DEFM 'BLASE VERGLEICH:'
  802D    45 20 56 45           
  8031    52 47 4C 45           
  8035    49 43 48 3A           
                                ;TEX1I: DEFB 78H,78H,78H,78H    
  0010                          TXL     EQU $-TEX1
                                
  8039    42 4C 41 53           TEX2:   DEFM 'BLASE GEFUNDEN: '
  803D    45 20 47 45           
  8041    46 55 4E 44           
  8045    45 4E 3A 20           
  8049    00 00 00 00           TEX2I:  DEFB 00H,00H,00H,00H    
                                
  804D    4B 49 53 59           TEX3:   DEFM 'KISYS 08.12.2009/17'
  8051    53 20 30 38           
  8055    2E 31 32 2E           
  8059    32 30 30 39           
  805D    2F 31 37              
  0013                          TXL3    EQU $-TEX3
                                ;-----------------------
                                ;  BIOS Function Summary
                                
  8060    C5                    BIOS:   PUSH    BC
  8061    E5                            PUSH    HL
  8062    5E                            LD      E,(HL)          ; Speicher Lesen 
  8063    CD 0005                       CALL    0005H
  8066    E1                            POP     HL
  8067    C1                            POP     BC
  8068    23                            INC     HL
  8069    10 F5                         DJNZ    BIOS
                                
  806B    C9                            RET
                                ;----------------------
                                ; Blasen Adress Buffer
                                
  806C    00 00 00 00           BF00:   DEFB    00H,00H,00H,00H,80H,00H         ; U,T1,T2 Zaehler zum Blase eroeffnen
  8070    80 00                 
  8072    00 00 00 00           BF01:   DEFB    00H,00H,00H,00H,00H,00H
  8076    00 00                 
  8078    00 00 00 00           BF02:   DEFB    00H,00H,00H,00H,00H,00H
        MACRO-80 3.43   27-Jul-81       PAGE    1-53


  807C    00 00                 
  807E    00 00 00 00           BF03:   DEFB    00H,00H,00H,00H,00H,00H
  8082    00 00                 
  8084    00 00 00 00           BF04:   DEFB    00H,00H,00H,00H,00H,00H
  8088    00 00                 
  808A    00 00 00 00           BF05:   DEFB    00H,00H,00H,00H,00H,00H
  808E    00 00                 
  8090    00 00 00 00           BF06:   DEFB    00H,00H,00H,00H         ; Datenbankverwaltung
  8094    00 00 00 00           BF07:   DEFB    00H,00H,00H,00H         ; Letzte HDD SORTIERADRESSE
                                ;----------------------
  8098    00 00 00 00           BF10:   DEFB    00H,00H,00H,00H,00H,00H,00H,00H ; User Type, G.Zaehler
  809C    00 00 00 00           
                                ;----------------------
                                ; Kalender
  80A0    30                    DAYJ:   DEFB    30H
  80A1    30                    DAYM:   DEFB    30H
  80A2    30                    DAYT:   DEFB    30H
  80A3    30 30 30 30           DAYZ:   DEFB    30H,30H,30H,30H,30H,30H
  80A7    30 30                 
                                
                                ;----------------------
                                ; Eingabe Meldung Zeile 24, Spalte 1
  0007                          CURUD   EQU 07H                 ; Zaehlen ab 01 - 09
  80A9    00 00                 ZEIL:   DEFB 00H,00H
  80AB    1B 5B 31 6D           COL01:  DEFB 1BH,5BH,31H,6DH,1BH,5BH,34H,34H,6DH        ;COLOR
  80AF    1B 5B 34 34           
  80B3    6D                    
  80B4    1B 5B 3F 32           CURON:  DEFB 1BH,5BH,3FH,32H,35H,68H            ;SET CURSOR ON
  80B8    35 68                 
  80BA    1B 5B 3F 32           CUROFF: DEFB 1BH,5BH,3FH,32H,35H,6CH            ;SET CURSOR OFF
  80BE    35 6C                 
  80C0    1B 5B 32 34           EBUFF:  DEFB 1BH,5BH,'2','4',';','0','1','H'
  80C4    3B 30 31 48           
  80C8    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  80CC    6D                    
  80CD    20 20 20 20                   DEFM '                           '
  80D1    20 20 20 20           
  80D5    20 20 20 20           
  80D9    20 20 20 20           
  80DD    20 20 20 20           
  80E1    20 20 20 20           
  80E5    20 20 20              
  80E8    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  80EC    3B 30 31 48           
  80F0    53 75 63 68           EBUFFE: DEFM 'Suche:              '
  80F4    65 3A 20 20           
  80F8    20 20 20 20           
  80FC    20 20 20 20           
  8100    20 20 20 20           
  0044                          EZLEN   EQU $-EBUFF
  8104    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  8108    3B 30 31 48           
  810C    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  8110    6D                    
  8111    4C 69 73 74                   DEFM 'List                '
  8115    20 20 20 20           
        MACRO-80 3.43   27-Jul-81       PAGE    1-54


  8119    20 20 20 20           
  811D    20 20 20 20           
  8121    20 20 20 20           
  8125    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  8129    3B 30 31 48           
  812D    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  8131    6D                    
  8132    8E 6E 64 65                   DEFM  142D,'ndern              '
  8136    72 6E 20 20           
  813A    20 20 20 20           
  813E    20 20 20 20           
  8142    20 20 20 20           
  8146    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  814A    3B 30 31 48           
  814E    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  8152    6D                    
  8153    53 70 65 69                   DEFM 'Speichern           '
  8157    63 68 65 72           
  815B    6E 20 20 20           
  815F    20 20 20 20           
  8163    20 20 20 20           
  8167    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  816B    3B 30 31 48           
  816F    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  8173    6D                    
  8174    56 65 72 67                   DEFM 'Vergessen           '
  8178    65 73 73 65           
  817C    6E 20 20 20           
  8180    20 20 20 20           
  8184    20 20 20 20           
  8188    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  818C    3B 30 31 48           
  8190    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  8194    6D                    
  8195    45 6E 64 65                   DEFM 'Ende                '
  8199    20 20 20 20           
  819D    20 20 20 20           
  81A1    20 20 20 20           
  81A5    20 20 20 20           
                                
  81A9    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  81AD    3B 30 31 48           
  81B1    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  81B5    6D                    
  81B6    20 20 20 4C                   DEFM '   List             '
  81BA    69 73 74 20           
  81BE    20 20 20 20           
  81C2    20 20 20 20           
  81C6    20 20 20 20           
                                
  81CA    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  81CE    3B 30 31 48           
  81D2    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  81D6    6D                    
  81D7    20 20 8E 6E                   DEFM '  ',142D,'ndern               '
  81DB    64 65 72 6E           
        MACRO-80 3.43   27-Jul-81       PAGE    1-55


  81DF    20 20 20 20           
  81E3    20 20 20 20           
  81E7    20 20 20 20           
  81EB    20 20 20              
                                
  81EE    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  81F2    3B 30 31 48           
  81F6    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  81FA    6D                    
  81FB    41 6E 6C 65                   DEFM 'Anlegen             '
  81FF    67 65 6E 20           
  8203    20 20 20 20           
  8207    20 20 20 20           
  820B    20 20 20 20           
                                
  820F    1B 5B 32 34                   DEFB 1BH,5BH,'2','4',';','0','1','H'
  8213    3B 30 31 48           
  8217    1B 5B 33 37                   DEFB 1BH,5BH,'3','7','m'        ; Vordergrund Zeichen
  821B    6D                    
  821C    53 70 65 69                   DEFM 'Speichern           '
  8220    63 68 65 72           
  8224    6E 20 20 20           
  8228    20 20 20 20           
  822C    20 20 20 20           
                                
  8230    3A                            DEFB ':'        ; Ende Text
                                
  8231    08                    ZCUR:   DEFB 08H                                
  8232    4C 49 53 54                   DEFM 'LISTF.COM'                                
  8236    46 2E 43 4F           
  823A    4D                    
  823B    07                            DEFB 07H        
  823C    4D 45 4D 2E                   DEFM 'MEM.COM'
  8240    43 4F 4D              
  8243    08                            DEFB 08H                                
  8244    45 44 49 54                   DEFM 'EDIT.COM'                         
  8248    2E 43 4F 4D           
                                
                                ;----------------------
                                
  824C    08                    PRLO1:  DEFB 08H
  824D    46 41 4B 54                   DEFM 'FAKT.COM'
  8251    2E 43 4F 4D           
                                
  8255    53 74 61 72           STEX:   DEFM 'Start Programm  '
  8259    74 20 50 72           
  825D    6F 67 72 61           
  8261    6D 6D 20 20           
  0010                          LSTEX   EQU $-STEX
                                
  8265    4B 49 53 79           LCDE:   DEFM  'KISystem Winterhalter'
  8269    73 74 65 6D           
  826D    20 57 69 6E           
  8271    74 65 72 68           
  8275    61 6C 74 65           
  8279    72                    
        MACRO-80 3.43   27-Jul-81       PAGE    1-56


  0015                          LCDEX   EQU     $-LCDE
                                
  827A    1B 5B 31 35           COMZ:   DEFB 1BH,5BH,31H,35H,3BH,30H,31H,48H,1BH,5BH,30H,4AH
  827E    3B 30 31 48           
  8282    1B 5B 30 4A           
  8286    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH,1BH,5BH,34H,32H,6DH
  828A    6D 1B 5B 34           
  828E    32 6D                 
  8290    43 6F 6D 6D                   DEFM  'Commando Zeile= '
  8294    61 6E 64 6F           
  8298    20 5A 65 69           
  829C    6C 65 3D 20           
  0026                          COMZX   EQU     $-COMZ
                                
                                
  82A0    1B 5B 32 34           KEYZ:   DEFB 1BH,5BH,32H,34H,3BH,30H,31H,48H
  82A4    3B 30 31 48           
  82A8    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH,1BH,5BH,34H,32H,6DH
  82AC    6D 1B 5B 34           
  82B0    32 6D                 
  82B2    4B 45 59 20                   DEFM  'KEY Stepp= '
  82B6    53 74 65 70           
  82BA    70 3D 20              
  001D                          KEYZX   EQU     $-KEYZ
                                
  82BD    1B 5B 30 31           MELD01: DEFB 1BH,5BH,30H,31H,3BH,30H,31H,48H
  82C1    3B 30 31 48           
  82C5    1B 5B 33 31                   DEFB 1BH,5BH,33H,31H,6DH,1BH,5BH,34H,34H,6DH
  82C9    6D 1B 5B 34           
  82CD    34 6D                 
  82CF    44 69 65 73                   DEFM  'Dieser Begriff ist mir nicht bekannt'
  82D3    65 72 20 42           
  82D7    65 67 72 69           
  82DB    66 66 20 69           
  82DF    73 74 20 6D           
  82E3    69 72 20 6E           
  82E7    69 63 68 74           
  82EB    20 62 65 6B           
  82EF    61 6E 6E 74           
  0036                          MELD01X EQU     $-MELD01
                                
  82F3    1B 5B 32 34           PROZ:   DEFB 1BH,5BH,32H,34H,3BH,30H,31H,48H
  82F7    3B 30 31 48           
  82FB    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH,1BH,5BH,34H,32H,6DH
  82FF    6D 1B 5B 34           
  8303    32 6D                 
  8305    44 61 74 65                   DEFM  'Dateiname= Dez/Text'
  8309    69 6E 61 6D           
  830D    65 3D 20 44           
  8311    65 7A 2F 54           
  8315    65 78 74              
  0025                          PROZX   EQU     $-PROZ
                                
  8318    1B 5B 32 34           DERR:   DEFB 1BH,5BH,32H,34H,3BH,31H,31H,48H
  831C    3B 31 31 48           
  8320    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH,1BH,5BH,34H,37H,6DH
        MACRO-80 3.43   27-Jul-81       PAGE    1-57


  8324    6D 1B 5B 34           
  8328    37 6D                 
  832A    44 49 53 4B                   DEFM  'DISK / HDD ERROR $'
  832E    20 2F 20 48           
  8332    44 44 20 45           
  8336    52 52 4F 52           
  833A    20 24                 
  833C    05 05                         DEFB 05H,05H
  0026                          L_DERR  EQU $-DERR
                                ;---------------------------
  833E    43 00 00 00           NBLASE: DEFB  MNBL1,00H,00H,00H,80H,00H                       ;         
  8342    80 00                 
                                        ;------------------
  8344    1B 5B 32 4A           NBL1:   DEFB  1BH,5BH,32H,4AH,1BH,5BH,48H,1BH,5BH,33H,37H,6DH ; 12 Zeichen
  8348    1B 5B 48 1B           
  834C    5B 33 37 6D           
  8350    1B 5B 31 6D                   DEFB  1BH,5BH,31H,6DH,1BH,5BH,34H,34H,6DH             ; 9 ZEICHEN
  8354    1B 5B 34 34           
  8358    6D                    
  8359    20 20 20 20                   DEFM '                                              ' ; 46 ZEICHEN
  835D    20 20 20 20           
  8361    20 20 20 20           
  8365    20 20 20 20           
  8369    20 20 20 20           
  836D    20 20 20 20           
  8371    20 20 20 20           
  8375    20 20 20 20           
  8379    20 20 20 20           
  837D    20 20 20 20           
  8381    20 20 20 20           
  8385    20 20                 
  0043                          MNBL1   EQU $-NBL1
                                        ; Taste
  8387    00                            DEFB 00H                                        ; Key Eingabe
                                        ; Programm
  8388    01                            DEFB 01H                                        ; Programme
  8389    0A                            DEFB 0AH                                        ; Leange Programm
  838A    4D 41 53 4B                   DEFM 'MASKE1.COM  '                             ; 10 ZEICHEN
  838E    45 31 2E 43           
  8392    4F 4D 20 20           
  8396    39                            DEFB 57D                                        ; zum naechsten Textlaenge
  8397    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH                        ; 5 ZEICHEN
  839B    6D                    
  839C    1B 5B 30 33                   DEFB 1BH,5BH,30H,33H,3BH,30H,31H,48H            ; 8 ZEICHEN
  83A0    3B 30 31 48           
  83A4    09 09 09                      DEFB 09H,09H,09H                                ; 3 ZEICHEN     
  83A7    4E 65 75 65                   DEFM 'Neue Seite eroeffnet'                     ; 20 ZEICHEN
  83AB    20 53 65 69           
  83AF    74 65 20 65           
  83B3    72 6F 65 66           
  83B7    66 6E 65 74           
  83BB    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN     
  83BD    20 30 20 20                   DEFM ' 0  A'                                    ; 5 ZEICHEN
  83C1    41                    
  83C2    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN
  83C4    20 31 20 20                   DEFM ' 1  S'                                    ; 5 ZEICHEN     
        MACRO-80 3.43   27-Jul-81       PAGE    1-58


  83C8    53                    
  83C9    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN
  83CB    20 39 20 20                   DEFM ' 9  E'                                    ; 5 ZEICHEN
  83CF    45                    
                                        ; TASTE
  83D0    10                            DEFB 10H
                                        ; PROGRAMM
  83D1    01                            DEFB 01H
  83D2    07                            DEFB 07H        
  83D3    4D 45 4D 2E                   DEFM 'MEM.COM     '
  83D7    43 4F 4D 20           
  83DB    20 20 20 20           
  83DF    00 00                         DEFB 00H,00H     ; 00= keine Keyeingabe folgend, 00= kein Progr.
                                
  00A3                          NBLLE   EQU     $-NBLASE
                                
  83E1    43 00 00 01           TBLASE: DEFB  MTBLA1,00H,00H,01H,80H,00H                                ;       
  83E5    80 00                 
                                        ;------------
  83E7    1B 5B 30 6D           TBLA1:  DEFB  1BH,5BH,30H,6DH,1BH,5BH,48H,1BH,5BH,33H,37H,6DH   ; 12 Zeichen
  83EB    1B 5B 48 1B           
  83EF    5B 33 37 6D           
  83F3    1B 5B 31 6D                   DEFB  1BH,5BH,31H,6DH,1BH,5BH,34H,34H,6DH               ; 9 ZEICHEN
  83F7    1B 5B 34 34           
  83FB    6D                    
  83FC    20 20 20 20                   DEFM '                                              '   ; 46 ZEICHEN
  8400    20 20 20 20           
  8404    20 20 20 20           
  8408    20 20 20 20           
  840C    20 20 20 20           
  8410    20 20 20 20           
  8414    20 20 20 20           
  8418    20 20 20 20           
  841C    20 20 20 20           
  8420    20 20 20 20           
  8424    20 20 20 20           
  8428    20 20                 
  0043                          MTBLA1  EQU $-TBLA1
                                        ; Taste
  842A    00                            DEFB 00H                                        ; Key Eingabe
                                        ; Programm
  842B    01                            DEFB 01H                                        ; Programme
  842C    0A                            DEFB 0AH                                        ; Leange Programm
  842D    45 44 49 54                   DEFM 'EDITOR.COM  '                             ; 10 ZEICHEN
  8431    4F 52 2E 43           
  8435    4F 4D 20 20           
  0058                          TBLLE   EQU     $-TBLASE
                                
  8439    43 00 02 00           SMASKE: DEFB MSMAS1,00H,02H,00H,76H,80H
  843D    76 80                 
                                        ;-------------------
                                        ; BLOCK LAENG OBEN SMASKE ERSTER WERT(43H)
  843F    1B 5B 32 4A           SMAS1:  DEFB 1BH,5BH,32H,4AH,1BH,5BH,48H,1BH,5BH,33H,37H,6DH
  8443    1B 5B 48 1B           
  8447    5B 33 37 6D           
  844B    1B 5B 31 6D                   DEFB 1BH,5BH,31H,6DH,1BH,5BH,34H,34H,6DH
        MACRO-80 3.43   27-Jul-81       PAGE    1-59


  844F    1B 5B 34 34           
  8453    6D                    
  8454    53 74 61 72                   DEFM 'Start                                         ' ;46D Zeichen
  8458    74 20 20 20           
  845C    20 20 20 20           
  8460    20 20 20 20           
  8464    20 20 20 20           
  8468    20 20 20 20           
  846C    20 20 20 20           
  8470    20 20 20 20           
  8474    20 20 20 20           
  8478    20 20 20 20           
  847C    20 20 20 20           
  8480    20 20                 
                                        ;------------------
  0043                          MSMAS1  EQU $-SMAS1
  8482    00                            DEFB 00H        
  8483    01                            DEFB 01H        ; ANZAHL PROGRAMMAUFRUFE
  8484    0A                            DEFB 0AH        ; FILE NAME LAENGE
  8485    4D 41 53 4B                   DEFM 'MASKE1.COM'
  8489    45 31 2E 43           
  848D    4F 4D                 
  848F    20 20 20 20                   DEFM '      Ersatzseite KI-System V1.0 '
  8493    20 20 45 72           
  8497    73 61 74 7A           
  849B    73 65 69 74           
  849F    65 20 4B 49           
  84A3    2D 53 79 73           
  84A7    74 65 6D 20           
  84AB    56 31 2E 30           
  84AF    20                    
  84B0    0D 0A                         DEFB 0DH,0AH
  84B2    10                            DEFB 10H        ; TASTATUR MENGE ZEICHENEINGABE
  84B3    01                            DEFB 01H        ; ANZAHL PROGRAMMAUFRUFE
  84B4    07                            DEFB 07H        ; FILE NAME LAENGE
  84B5    4D 45 4D 2E                   DEFM 'MEM.COM'
  84B9    43 4F 4D              
  0083                          SRAL    EQU $-SMASKE
                                
  84BC    39                            DEFB 57D
  84BD    1B 5B 33 37                   DEFB 1BH,5BH,33H,37H,6DH                        ; 5 ZEICHEN
  84C1    6D                    
  84C2    1B 5B 30 33                   DEFB 1BH,5BH,30H,33H,3BH,30H,31H,48H            ; 8 ZEICHEN
  84C6    3B 30 31 48           
  84CA    09 09 09                      DEFB 09H,09H,09H                                ; 3 ZEICHEN     
  84CD    4E 65 75 65                   DEFM 'Neue TYPE2 eroeffnet'                     ; 20 ZEICHEN
  84D1    20 54 59 50           
  84D5    45 32 20 65           
  84D9    72 6F 65 66           
  84DD    66 6E 65 74           
  84E1    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN     
  84E3    20 30 20 41                   DEFM ' 0 A?'                                    ; 5 ZEICHEN
  84E7    3F                    
  84E8    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN
  84EA    20 31 20 20                   DEFM ' 1  S'                                    ; 5 ZEICHEN     
  84EE    53                    
        MACRO-80 3.43   27-Jul-81       PAGE    1-60


  84EF    0A 0D                         DEFB 0AH,0DH                                    ; 2 ZEICHEN
  84F1    20 39 20 20                   DEFM ' 9  E'                                    ; 5 ZEICHEN
  84F5    45                    
                                        ; TASTE
  84F6    10                            DEFB 10H
                                        ; PROGRAMM
  84F7    01                            DEFB 01H
  84F8    07                            DEFB 07H        
  84F9    4D 45 4D 2E                   DEFM 'MEM.COM     '
  84FD    43 4F 4D 20           
  8501    20 20 20 20           
  8505    00 00                         DEFB 00H,00H     ; 00= keine Keyeingabe folgend, 00= kein Progr.
                                
                                END
        MACRO-80 3.43   27-Jul-81       PAGE    S


Macros:

Symbols:
7617    _ED12           793A    _WAIT1          7F06    ASCII_CODE      
7F1F    ASC_1           7F2F    ASC_2           0047    BAUD1           
0047    BAUD2           0047    BAUD3           806C    BF00            
8072    BF01            8078    BF02            807E    BF03            
8084    BF04            808A    BF05            8090    BF06            
8094    BF07            8098    BF10            6503    BFRHH           
6502    BFRHL           6501    BFRLH           6500    BFRLL           
650F    BFSHH           650E    BFSHL           650D    BFSLH           
650C    BFSLL           650B    BFVHH           650A    BFVHL           
6509    BFVLH           6508    BFVLL           8060    BIOS            
706E    BL              70A9    BL00            70C8    BL000           
70DD    BL01            7174    BL02            71A6    BL021           
720F    BL022           7215    BL023           720C    BL02X           
7217    BL03            7232    BL030           7228    BL031           
7250    BL033           732B    BL04            71B2    BL120           
7205    BL121           71E5    BL123           71F7    BL124           
71FE    BL125           7289    BL13            726C    BL131           
7271    BL132           733B    BL14            7298    BL23            
72A0    BL231           72B0    BL33            72BB    BL43            
72C6    BL53            72E6    BL73            72EC    BL736           
72F9    BL83            731D    BL830           7325    BL831           
7314    BL84            6200    BLAN            7343    BS10            
6205    BSTAT           0080    BUFF            0020    CMD_READSEC     
0030    CMD_WRITESEC    7913    COFF            705F    COL0            
80AB    COL01           7064    COL1            827A    COMZ            
0026    COMZX           7902    CON             6C3F    COP             
0007    CPOS            0010    CTC             78C0    CU0             
791A    CUR01           7909    CUR02           8008    CUR03           
80BA    CUROFF          80B4    CURON           6518    CURS            
651C    CURT            0007    CURUD           788D    CUT             
80A0    DAYJ            80A1    DAYM            80A2    DAYT            
80A3    DAYZ            00F4    DCI             0001    DCLR            
000C    DCON            8318    DERR            0002    DHOM            
79AC    DISK            0001    DISPLAY         80C0    EBUFF           
80F0    EBUFFE          75A6    ED00            7598    ED01            
75A0    ED02            7609    ED03            75CA    ED10            
7600    ED100           7603    ED11            7615    ED12            
762D    ED13            765C    ED14            7661    ED15            
765E    ED20            7664    ED30            767C    ED31            
768F    ED32            7691    ED33            7693    ED40            
769E    ED41            76AD    ED42            76B2    ED43            
76B7    ED44            76CA    ED441           76E1    ED442           
76E5    ED50            76FA    ED51            7580    EING            
76FC    EING11          772B    EING21          773B    EING22          
7756    EING23          7766    EING24          7775    EING25          
778E    EING26          7790    EING27          7798    EING30          
0040    EOFF            8020    EPROMON         796C    ERR1            
724B    EXIT            8017    EXTERN          7162    EZ01            
716E    EZ02            7102    EZ03            7132    EZ04            
0044    EZLEN           005C    FCB             006B    FCBCR           
005D    FCBFN           0065    FCBFT           007C    FCBRA           
79DE    FREI            0005    FSET            0800    HDD             
00BE    HDDE            795B    HDD_ERROR       7974    HDD_INFO        
7941    HDD_INIT        7982    HDD_READ        793A    HDD_WAIT        
        MACRO-80 3.43   27-Jul-81       PAGE    S-1


7E31    HDIST           7850    HEX00           77E8    HEX11           
77FB    HEX12           7850    HEX14           7845    HEXA            
78F3    HEXC            77DD    HEXI1           77F0    HEXI2           
77FF    HEXIE           7802    HEXP            00F0    IDE             
00FD    IDECHI          00FC    IDECLO          00FF    IDECMD          
00F8    IDEDAT          00F6    IDEDOR          00F9    IDEERR          
7990    IDERES          7996    IDERES1         00FA    IDESCNT         
00FE    IDESDH          00FB    IDESNUM         00FF    IDESTAT         
8010    INTERN          0000    KANAL0          0001    KANAL1          
0003    KANAL3          0004    KANAL4          0005    KANAL5          
7A1D    KEY01           0001    KEYIN           0002    KEYOUT          
7A0E    KEYST           82A0    KEYZ            001D    KEYZX           
701E    KI              7090    KI1             7A1F    LBA0            
7A68    LBA20           7A69    LBA21           7A65    LBA4            
7A6E    LBA5            0060    LCD             8265    LCDE            
0015    LCDEX           7AEB    LIS0            7AED    LIS1            
7ABF    LIST            6513    LOGHH           6512    LOGHL           
6511    LOGLH           6510    LOGLL           0100    LOS             
0120    LOS1            0010    LSTEX           0026    L_DERR          
7AA8    L__6            7AA0    L__7            779E    MAS00           
77AE    MAS01           77CE    MAS02           82BD    MELD01          
0036    MELD01X         A101    MMC             0007    MMCE            
0043    MNBL1           0043    MSMAS1          0043    MTBLA1          
8344    NBL1            833E    NBLASE          00A3    NBLLE           
001C    PIOA            001E    PIOB            824C    PRLO1           
0130    PRO             7000    PROG            82F3    PROZ            
0025    PROZX           0005    P_READ          0006    P_WRITE         
6524    RADR            6000    RAM             0021    RAMH            
0000    RAML            6727    RAMS            6B27    RAMT            
6527    RAMV            0000    RBLAN           0005    RBSTAT          
7CD7    RD01            7D93    RD02            7D44    RD03            
7C73    RD06            7B81    RD07            7B84    RD08            
7B8C    RD09            7CAC    RD16            7CB9    RD17            
7CC1    RD170           7CCC    RD171           7C18    RD25            
7C4A    RD250           7C2C    RD255           7C36    RD26            
7D79    RD30            7C68    RD35            7C56    RD36            
7DAA    RD90            7DCE    RD91            7DD1    RD911           
7DD7    RD92            7C8F    RDD1            7DE4    RDREAD          
7FFD    RDU01           8000    RDU02           7FDF    RDU03           
7E0D    RDWRITE         F814    READ            0000    REG1            
00C1    REG3            0044    REG4            00EA    REG5            
6526    RMEN            0006    RSOTR           0004    RTERM           
6BEF    RTEX            0002    RTYPE1          0003    RTYPE2          
7018    RUN             0001    RUSER           787D    SA1             
7881    SA2             7883    SA3             6520    SANDB           
786D    SANDU           0020    SDC             0004    SELDM           
00F7    SELDS           F838    SELDSK          F82F    SETDMA          
F835    SETSEC          F832    SETTRK          0018    SIOA            
001A    SIOB            0018    SIORES          843F    SMAS1           
8439    SMASKE          0083    SRAL            8255    STEX            
7376    STX01           7368    SU00            737C    SU01            
73CD    SU02            73D0    SU03            73E4    SU04            
74A8    SU21            755D    SU23            748D    SU25            
7565    SU32            7573    SU33            753B    SU52            
754F    SU520           74B1    SU62            74E3    SU63            
746D    SU80            7423    SU82            7433    SU83            
        MACRO-80 3.43   27-Jul-81       PAGE    S-2


743C    SU84            741B    SU85            745A    SU86            
7467    SU87            740A    SU88            74F4    SU90            
7538    SU95            7504    SU99            79EC    SUCH0           
79FA    SUCH1           79FC    SUCH2           7000    T0              
7003    T1              7006    T2              7009    T3              
700C    T4              700F    T5              7012    T6              
7015    T7              7AF8    TAS             7B5B    TAS00           
7BEB    TAS03           7D16    TAS22           7D3C    TAS24           
7E39    TASK            7E84    TASK99          FFA2    TASKSP          
83E7    TBLA1           83E1    TBLASE          0058    TBLLE           
7260    TEING           6204    TERM            801C    TERN            
8029    TEX1            8039    TEX2            8049    TEX2I           
804D    TEX3            0004    TIME1           0004    TIME2           
0004    TIME3           FFAB    TRACK           FFA5    TRACKH          
FFA4    TRACKL          7E88    TWRITE          0010    TXL             
0013    TXL3            6202    TYPE1           6203    TYPE2           
7EAC    UHR00           7EF9    UHR01           7F37    UHR10           
0080    URCS            6201    USER            792F    WAITDRQ         
7924    WAITRDY         00F0    WDTCR           00F1    WDTER           
F817    WRITE           8231    ZCUR            77D9    ZEI00           
80A9    ZEIL            



No Fatal error(s)


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           